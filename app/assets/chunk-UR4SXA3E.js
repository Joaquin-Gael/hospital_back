import{a as I}from"./chunk-Y6I3CS6I.js";import{a as D}from"./chunk-BR3QFQIC.js";import"./chunk-GK5PG2NL.js";import{a as T}from"./chunk-R25INWIT.js";import"./chunk-HDR7MDZE.js";import"./chunk-O57RU464.js";import{a as L}from"./chunk-YOZKJIIB.js";import{b as E,d as k,h as F}from"./chunk-RTO3QJN4.js";import"./chunk-NSPTTQBB.js";import"./chunk-ZGRDZCQA.js";import{b as z,c as V,e as C,f as A,g as G,j as B,m as R,n as U,t as q,v as N}from"./chunk-SZQKAXFT.js";import{Cb as p,Hb as t,Ib as n,Jb as d,Ob as _,Pb as y,S as b,Uc as S,Zb as l,_a as c,aa as m,f as M,ka as h,kb as P,la as v,pb as u,vb as O,wb as x,yb as w}from"./chunk-MFDETKI4.js";import"./chunk-4CLCTAJ7.js";function H(i,r){i&1&&(t(0,"span"),l(1,"El email es requerido para continuar"),n())}function $(i,r){i&1&&(t(0,"span"),l(1,"Ingrese un email v\xE1lido"),n())}function Y(i,r){if(i&1&&(t(0,"div",21),u(1,H,2,0,"span")(2,$,2,0,"span"),n()),i&2){let a,e,o=y();c(),p(!((a=o.loginForm.get("email"))==null||a.errors==null)&&a.errors.required||o.showEmailValidationError?1:-1),c(),p(!((e=o.loginForm.get("email"))==null||e.errors==null)&&e.errors.email&&!(!((e=o.loginForm.get("email"))==null||e.errors==null)&&e.errors.required)?2:-1)}}function J(i,r){i&1&&(h(),t(0,"svg",26),d(1,"path",35)(2,"circle",36),n())}function K(i,r){i&1&&(h(),t(0,"svg",26),d(1,"path",37)(2,"line",38),n())}function Q(i,r){i&1&&(t(0,"div",21),l(1," La contrase\xF1a es requerida "),n())}function W(i,r){i&1&&(d(0,"span",39),l(1," Iniciando sesi\xF3n... "))}function X(i,r){i&1&&l(0," Iniciar sesi\xF3n ")}var j=class i{fb=m(q);authService=m(I);logger=m(L);storage=m(T);router=m(k);route=m(E);notificationService=m(D);destroy$=new M;showPassword=!1;isSubmitting=!1;showEmailValidationError=!1;loginForm=this.fb.group({email:["",[C.required,C.email]],password:["",[C.required]],remember:[!1]});ngOnInit(){let r=this.route.snapshot.queryParamMap.get("returnUrl");if(this.logger.debug("returnUrl completo recibido:",r),r?.includes("a="))try{let o=new URLSearchParams(r.split("?")[1]).get("a");if(this.logger.debug("C\xF3digo secreto extra\xEDdo (raw):",o),!o||o.trim()===""){this.logger.warn("El c\xF3digo secreto est\xE1 vac\xEDo o mal formado.");return}this.authService.decode(o).pipe(b(this.destroy$)).subscribe({next:()=>{this.logger.debug("Token decodificado exitosamente");let s=decodeURIComponent(r.split("?")[0]);this.router.navigateByUrl(s||"/user_panel")},error:s=>{this.logger.error("Error al decodificar el token:",s),this.notificationService.error("Error al procesar el inicio de sesi\xF3n con Google")}});return}catch(e){this.logger.error("Error al extraer el c\xF3digo secreto:",e)}let a=this.storage.getRememberEmail();!this.authService.isLoggedIn()&&a?this.loginForm.patchValue({email:a,remember:!0}):this.authService.isLoggedIn()&&this.router.navigateByUrl("/home"),this.loginForm.get("email")?.valueChanges.pipe(b(this.destroy$)).subscribe(()=>{this.showEmailValidationError&&(this.showEmailValidationError=!1)})}togglePassword(){this.showPassword=!this.showPassword}onLoginGoogle(){this.logger.debug("Iniciando login con Google"),this.authService.oauthLogin("google")}onForgotPassword(r){r.preventDefault();let a=this.loginForm.get("email"),e=a?.value?.trim();if(!e||a?.invalid){this.showEmailValidationError=!0,a?.markAsTouched(),setTimeout(()=>{document.getElementById("email")?.focus()},100),this.notificationService.error("Por favor, ingresa un email v\xE1lido antes de continuar con el restablecimiento de contrase\xF1a.",{duration:4e3,action:{label:"Cerrar",action:()=>this.notificationService.dismissAll()}});return}this.storage.setTempResetEmail(e),this.logger.info("Email guardado para reset de contrase\xF1a:",e),this.router.navigate(["/recovery-password"])}onLogin(){if(this.loginForm.invalid||this.isSubmitting){this.loginForm.markAllAsTouched(),this.notificationService.error("Por favor complet\xE1 correctamente el email y la contrase\xF1a.");return}this.isSubmitting=!0;let{email:r,password:a,remember:e}=this.loginForm.value,o=r.trim();e?this.storage.setRememberEmail(o):this.storage.removeRememberEmail();let s={email:o,password:a};this.authService.login(s).pipe(b(this.destroy$)).subscribe({next:()=>{this.isSubmitting=!1,this.notificationService.success(`\xA1Inicio de sesi\xF3n exitoso!
 Redirigiendo...`,{duration:5e3,action:{label:"Cerrar",action:()=>this.notificationService.dismissAll()}});let g=this.route.snapshot.queryParams.returnUrl||"/user_panel";setTimeout(()=>this.router.navigateByUrl(g),2e3)},error:g=>{this.isSubmitting=!1,this.logger.error("Error al iniciar sesi\xF3n:",g),this.notificationService.error("Error al iniciar sesi\xF3n, por favor, intenta nuevamente.",{duration:5e3,action:{label:"Cerrar",action:()=>this.notificationService.dismissAll()}})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=P({type:i,selectors:[["app-login"]],decls:54,vars:12,consts:[[1,"hospital-auth-container"],[1,"auth-card"],[1,"auth-header"],[1,"logo"],["xmlns","http://www.w3.org/2000/svg","width","32","height","32","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M22 12h-4l-3 9L9 3l-3 9H2"],[1,"auth-form",3,"ngSubmit","formGroup"],["type","button",1,"google-btn",3,"click"],[1,"google-btn__icon"],["width","18","height","18","viewBox","0 0 24 24"],["fill","#4285F4","d","M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"],["fill","#34A853","d","M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"],["fill","#FBBC05","d","M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"],["fill","#EA4335","d","M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"],[1,"google-btn__text"],[1,"auth-divider"],[1,"auth-divider__line"],[1,"auth-divider__text"],[1,"form-group"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","ejemplo@correo.com",1,"form-input"],[1,"error-message"],["for","password",1,"form-label"],[1,"password-input"],["id","password","formControlName","password","placeholder","Ingrese su contrase\xF1a",1,"form-input",3,"type"],["type","button",1,"toggle-password",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"form-options"],[1,"checkbox-wrapper"],["type","checkbox","formControlName","remember"],[1,"checkbox-text"],["href","#",1,"forgot-password",3,"click"],["type","submit",1,"btn-primary",3,"disabled"],[1,"auth-footer"],["href","/register"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"],["cx","12","cy","12","r","3"],["d","M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"],["x1","1","y1","1","x2","23","y2","23"],[1,"loading-spinner"]],template:function(a,e){if(a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),h(),t(4,"svg",4),d(5,"path",5),n()(),v(),t(6,"h1"),l(7,"Acceso al Sistema"),n(),t(8,"p"),l(9,"Ingrese sus credenciales para continuar"),n()(),t(10,"form",6),_("ngSubmit",function(){return e.onLogin()}),t(11,"button",7),_("click",function(){return e.onLoginGoogle()}),t(12,"div",8),h(),t(13,"svg",9),d(14,"path",10)(15,"path",11)(16,"path",12)(17,"path",13),n()(),v(),t(18,"span",14),l(19,"Continuar con Google"),n()(),t(20,"div",15),d(21,"span",16),t(22,"span",17),l(23,"o"),n(),d(24,"span",16),n(),t(25,"div",18)(26,"label",19),l(27,"Correo electr\xF3nico"),n(),d(28,"input",20),u(29,Y,3,2,"div",21),n(),t(30,"div",18)(31,"label",22),l(32,"Contrase\xF1a"),n(),t(33,"div",23),d(34,"input",24),t(35,"button",25),_("click",function(){return e.togglePassword()}),u(36,J,3,0,":svg:svg",26)(37,K,3,0,":svg:svg",26),n()(),u(38,Q,2,0,"div",21),n(),t(39,"div",27)(40,"label",28),d(41,"input",29),t(42,"span",30),l(43,"Recordarme"),n()(),t(44,"a",31),_("click",function(s){return e.onForgotPassword(s)}),l(45,"\xBFOlvidaste tu contrase\xF1a?"),n()(),t(46,"button",32),u(47,W,2,0)(48,X,1,0),n(),t(49,"div",33)(50,"p"),l(51,"\xBFNo tienes una cuenta? "),t(52,"a",34),l(53,"Reg\xEDstrate aqu\xED"),n()()()()()()),a&2){let o,s,g,f;c(10),x("formGroup",e.loginForm),c(18),w("form-input--error",((o=e.loginForm.get("email"))==null?null:o.touched)&&((o=e.loginForm.get("email"))==null?null:o.invalid)||e.showEmailValidationError),c(),p((s=e.loginForm.get("email"))!=null&&s.touched&&((s=e.loginForm.get("email"))!=null&&s.invalid)||e.showEmailValidationError?29:-1),c(5),w("form-input--error",((g=e.loginForm.get("password"))==null?null:g.touched)&&((g=e.loginForm.get("password"))==null?null:g.invalid)),x("type",e.showPassword?"text":"password"),c(),O("aria-label",e.showPassword?"Ocultar contrase\xF1a":"Mostrar contrase\xF1a"),c(),p(e.showPassword?37:36),c(2),p((f=e.loginForm.get("password"))!=null&&f.touched&&(!((f=e.loginForm.get("password"))==null||f.errors==null)&&f.errors.required)?38:-1),c(8),x("disabled",e.loginForm.invalid||e.isSubmitting),c(),p(e.isSubmitting?47:48)}},dependencies:[N,B,V,z,A,G,R,U,S,F],styles:[".hospital-auth-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;background-color:#f9fafb;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;margin-top:80px}.auth-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;border-radius:8px;box-shadow:0 4px 6px #0000001a;border:1px solid #e5e7eb}.auth-header[_ngcontent-%COMP%]{padding:32px 32px 24px;text-align:center;border-bottom:1px solid #f3f4f6}.auth-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{margin-bottom:24px}.auth-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#2563eb;width:32px;height:32px}.auth-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 8px;font-size:24px;font-weight:600;color:#1f2937;line-height:1.2}.auth-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#4b5563;line-height:1.4}.auth-form[_ngcontent-%COMP%]{padding:32px}.google-btn[_ngcontent-%COMP%]{width:100%;height:48px;background-color:#fff;border:1px solid #d1d5db;border-radius:8px;display:flex;align-items:center;justify-content:center;gap:12px;cursor:pointer;transition:all .2s ease-in-out;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;font-size:16px;font-weight:500;color:#374151;margin-bottom:24px;position:relative;overflow:hidden}.google-btn[_ngcontent-%COMP%]:hover{background-color:#f9fafb;border-color:#9ca3af;box-shadow:0 2px 4px #0000001a}.google-btn[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px #2563eb1a}.google-btn[_ngcontent-%COMP%]:active{background-color:#f3f4f6;transform:translateY(1px)}.google-btn__icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-shrink:0}.google-btn__text[_ngcontent-%COMP%]{font-weight:500;letter-spacing:.25px}.auth-divider[_ngcontent-%COMP%]{display:flex;align-items:center;margin:24px 0}.auth-divider__line[_ngcontent-%COMP%]{flex:1;height:1px;background-color:#e5e7eb}.auth-divider__text[_ngcontent-%COMP%]{padding:0 16px;font-size:14px;color:#6b7280;font-weight:500;background-color:#fff}.form-group[_ngcontent-%COMP%]{margin-bottom:24px}.form-label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-size:14px;font-weight:500;color:#374151}.form-input[_ngcontent-%COMP%]{width:100%;padding:12px 16px;font-size:16px;border:1px solid #d1d5db;border-radius:8px;background-color:#fff;color:#1f2937;transition:all .2s ease-in-out}.form-input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px #2563eb1a}.form-input[_ngcontent-%COMP%]:hover:not(:focus){border-color:#9ca3af}.form-input--error[_ngcontent-%COMP%]{border-color:#dc2626}.form-input--error[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #dc26261a}.password-input[_ngcontent-%COMP%]{position:relative}.password-input[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{padding-right:48px}.password-input[_ngcontent-%COMP%]   .toggle-password[_ngcontent-%COMP%]{position:absolute;right:16px;top:50%;transform:translateY(-50%);background:none;border:none;color:#9ca3af;cursor:pointer;padding:4px;border-radius:4px;transition:all .2s ease-in-out}.password-input[_ngcontent-%COMP%]   .toggle-password[_ngcontent-%COMP%]:hover{color:#4b5563;background-color:#f3f4f6}.password-input[_ngcontent-%COMP%]   .toggle-password[_ngcontent-%COMP%]:focus{outline:none;color:#4b5563;background-color:#f3f4f6}.error-message[_ngcontent-%COMP%]{margin-top:8px;font-size:14px;color:#dc2626;font-weight:500}.form-options[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}@media (max-width: 480px){.form-options[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}}.checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;font-size:14px;color:#374151}.checkbox-wrapper[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:8px;width:16px;height:16px;accent-color:#2563eb}.forgot-password[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-size:14px;font-weight:500;transition:all .2s ease-in-out}.forgot-password[_ngcontent-%COMP%]:hover{color:#1d4ed8;text-decoration:underline}.forgot-password[_ngcontent-%COMP%]:focus{outline:none;color:#1d4ed8;text-decoration:underline}.btn-primary[_ngcontent-%COMP%]{width:100%;padding:14px 24px;background-color:#2563eb;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:500;cursor:pointer;transition:all .2s ease-in-out;display:flex;align-items:center;justify-content:center;gap:8px}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#1d4ed8}.btn-primary[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 3px #2563eb33}.btn-primary[_ngcontent-%COMP%]:disabled{background-color:#9ca3af;cursor:not-allowed}.loading-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.auth-footer[_ngcontent-%COMP%]{text-align:center;margin-top:32px;padding-top:24px;border-top:1px solid #f3f4f6}.auth-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#4b5563}.auth-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500;transition:all .2s ease-in-out}.auth-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#1d4ed8;text-decoration:underline}.auth-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus{outline:none;color:#1d4ed8;text-decoration:underline}@media (max-width: 768px){.hospital-auth-container[_ngcontent-%COMP%]{padding:16px;margin-top:60px}.auth-header[_ngcontent-%COMP%]{padding:24px 24px 16px}.auth-form[_ngcontent-%COMP%]{padding:24px}.feedback-message[_ngcontent-%COMP%]{margin:16px 24px 0}}@media (max-width: 480px){.auth-card[_ngcontent-%COMP%]{max-width:100%}.auth-header[_ngcontent-%COMP%]{padding:16px}.auth-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px}.auth-form[_ngcontent-%COMP%]{padding:16px}.form-input[_ngcontent-%COMP%]{font-size:16px}.feedback-message[_ngcontent-%COMP%]{margin:16px}}"]})};export{j as LoginComponent};
