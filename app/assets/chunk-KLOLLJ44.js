import{c as L,e as R,f as U}from"./chunk-4PPNR7WW.js";import{a as H}from"./chunk-RBRDWJHI.js";import"./chunk-QMYIRM4F.js";import{a as B}from"./chunk-2WAWTWTY.js";import{a as $}from"./chunk-Y6I3CS6I.js";import{a as F}from"./chunk-BR3QFQIC.js";import"./chunk-GK5PG2NL.js";import"./chunk-R25INWIT.js";import"./chunk-HDR7MDZE.js";import"./chunk-O57RU464.js";import{a as N}from"./chunk-YOZKJIIB.js";import{d as V}from"./chunk-RTO3QJN4.js";import"./chunk-NSPTTQBB.js";import"./chunk-ZGRDZCQA.js";import{$b as g,Bb as v,Cb as S,Fb as k,Gb as A,Hb as e,Ib as o,Jb as l,Mb as O,Nc as D,Ob as C,Pb as s,S as _,Sc as j,Uc as I,Zb as r,_a as a,_b as b,aa as d,f as P,ia as x,ja as f,jc as z,ka as u,kb as y,la as h,lc as E,mc as T,pb as w,wb as m}from"./chunk-MFDETKI4.js";import"./chunk-4CLCTAJ7.js";var q=(i,n,t)=>({"status-waiting":i,"status-completed":n,"status-cancelled":t});function Y(i,n){i&1&&l(0,"app-loading-spinner",1),i&2&&m("message","Cargando turnos...")}function J(i,n){if(i&1){let t=O();e(0,"div",3)(1,"div",5)(2,"div",6)(3,"span",7),r(4),o(),e(5,"span",8),r(6),o(),e(7,"span",9),r(8),o()(),e(9,"div",10),u(),e(10,"svg",11),l(11,"path",12),o(),r(12),o()(),h(),e(13,"div",13)(14,"h3",14),r(15),o(),e(16,"div",15),u(),e(17,"svg",11),l(18,"path",16),o(),r(19),o(),h(),e(20,"div",17)(21,"span",18),r(22),E(23,"titlecase"),o()()(),e(24,"div",19)(25,"button",20),C("click",function(){let c=x(t).$implicit,M=s(2);return f(M.onReschedule(c.id))}),r(26," Reprogramar "),o(),e(27,"button",21),C("click",function(){let c=x(t).$implicit,M=s(2);return f(M.onCancel(c.turnId))}),r(28," Cancelar "),o()()()}if(i&2){let t=n.$implicit,p=s(2);a(4),b(p.getDayName(t.date)),a(2),b(p.getDayNumber(t.date)),a(2),b(p.getMonthName(t.date)),a(4),g(" ",t.time," "),a(3),g(" ",t.specialty," "),a(4),g(" Doctor: ",t.doctorName," "),a(2),m("ngClass",z(12,q,t.state==="waiting",t.state==="finished",t.state==="cancelled")),a(),g(" ",T(23,10,t.state)," "),a(3),m("disabled",t.state!=="waiting"),a(2),m("disabled",t.state!=="waiting")}}function K(i,n){if(i&1){let t=O();e(0,"div",4)(1,"div",22),u(),e(2,"svg",11),l(3,"path",23),o()(),h(),e(4,"h2"),r(5,"No hay turnos agendados"),o(),e(6,"p"),r(7,"Agenda un nuevo turno para comenzar."),o(),e(8,"button",24),C("click",function(){x(t);let c=s(2);return f(c.onNewAppointment())}),r(9," Agendar turno "),o()()}}function Q(i,n){if(i&1&&(e(0,"div",2),k(1,J,29,16,"div",3,v().trackById,!0,K,10,0,"div",4),o()),i&2){let t=s();a(),A(t.filteredAppointments)}}var G=class i{authService=d($);appointmentService=d(H);logger=d(N);router=d(V);notificationService=d(F);dialog=d(L);appointments=[];user=null;error=null;loading=!0;destroy$=new P;ngOnInit(){if(this.appointments.length>0){this.appointments=this.appointments.filter(n=>n.state=="waiting"),this.loading=this.loading;return}if(!this.authService.isLoggedIn()){this.logger.info("Usuario no autenticado, redirigiendo a /login"),this.router.navigate(["/login"]);return}this.authService.getUser().pipe(_(this.destroy$)).subscribe({next:n=>{if(console.log("User data received:",n),!n){this.error="No se encontraron datos del usuario",this.logger.error("No user data found"),this.router.navigate(["/login"]),this.loading=!1;return}this.user=n,this.loadAppointments(this.user.id)},error:n=>{console.log("Error loading user:",n),this.error="Error al cargar los datos del usuario",this.loading=!1,this.logger.error("Failed to load user",n),this.router.navigate(["/login"])}})}loadAppointments(n){console.log("loadAppointments called with ID:",n),this.loading=!0,this.appointmentService.getTurnsByUserId(n).pipe(_(this.destroy$)).subscribe({next:t=>{console.log("Turns received:",t),this.appointments=this.mapTurnsToAppointments(t),this.loading=!1,this.logger.debug("Appointments loaded successfully",this.appointments)},error:t=>{console.log("Error in loadAppointments:",t),this.error="Error al mostrar los turnos",this.loading=!1,this.logger.error("Error al mostrar los turnos: ",t)}})}mapTurnsToAppointments(n){return n.map(t=>({id:t.appointment_id??t.id,turnId:t.id,date:t.date,time:t.time.split(":").slice(0,2).join(":"),specialty:t.service?.[0]?.name??"Sin especialidad",doctorName:t.doctor?`${t.doctor.first_name} ${t.doctor.last_name}`.trim():"Sin m\xE9dico asignado",state:t.state}))}get filteredAppointments(){return this.appointments.length>0?this.appointments.filter(n=>n.state==="waiting"):this.appointments}onReschedule(n){console.log(`Rescheduling appointment: ${n}`),this.notificationService.info("Reprogramaci\xF3n no implementada")}onCancel(n){this.dialog.open(U,{data:{title:"Cancelar turno",message:"\xBFEst\xE1s seguro de que deseas cancelar este turno?"}}).afterClosed().subscribe(p=>{p&&this.appointmentService.updateTurnState(n,"cancelled").pipe(_(this.destroy$)).subscribe({next:()=>{this.notificationService.success("Turno cancelado correctamente"),this.user?.id&&this.loadAppointments(this.user.id)},error:c=>{this.notificationService.error("Error al cancelar el turno"),this.logger.error("Failed to cancel turn",c)}})})}onNewAppointment(){this.router.navigate(["/shifts"])}getDayName(n){return new Date(n).toLocaleDateString("es-AR",{weekday:"long"}).toLowerCase()}getDayNumber(n){return new Date(n).getDate().toString().padStart(2,"0")}getMonthName(n){return new Date(n).toLocaleDateString("es-AR",{month:"long"}).toLowerCase()}trackById(n,t){return t.id}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=y({type:i,selectors:[["app-appointments"]],decls:3,vars:1,consts:[[1,"appointments"],[3,"message"],[1,"appointments__grid"],[1,"appointment-card"],[1,"empty-state"],[1,"appointment-card__header"],[1,"appointment-card__date"],[1,"appointment-card__day-name"],[1,"appointment-card__day"],[1,"appointment-card__month"],[1,"appointment-card__time"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"icon"],["stroke-linecap","round","stroke-linejoin","round","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"appointment-card__body"],[1,"appointment-card__specialty"],[1,"appointment-card__doctor"],["stroke-linecap","round","stroke-linejoin","round","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"appointment-card__status"],[1,"status-badge",3,"ngClass"],[1,"appointment-card__footer"],[1,"btn","btn--outline","btn--sm",3,"click","disabled"],[1,"btn","btn--danger","btn--sm",3,"click","disabled"],[1,"empty-state__icon"],["stroke-linecap","round","stroke-linejoin","round","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"btn","btn--primary",3,"click"]],template:function(t,p){t&1&&(e(0,"section",0),w(1,Y,1,1,"app-loading-spinner",1)(2,Q,4,1,"div",2),o()),t&2&&(a(),S(p.loading?1:2))},dependencies:[I,D,j,R,B],styles:[".icon[_ngcontent-%COMP%]{width:20px;height:20px;stroke-width:2}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;transition:all .2s ease;border:none;color:#fff}.btn--primary[_ngcontent-%COMP%]{color:#fff;background:linear-gradient(135deg,#3b82f6,#1d4ed8)}.btn--outline[_ngcontent-%COMP%]{background-color:transparent;color:#1f2937;border:1px solid #e5e7eb}.btn--outline[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.btn--danger[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff}.btn--danger[_ngcontent-%COMP%]:hover{background-color:#ed2d2d}.btn--sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.btn[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:16px;height:16px}.btn-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background-color:transparent;color:#6b7280;border:none;cursor:pointer;transition:all .2s ease}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.btn-icon[_ngcontent-%COMP%]:hover{background-color:#f9fafb;color:#3b82f6}.btn-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:18px;height:18px}.empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;padding:60px 20px;text-align:center}.empty-state__icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:80px;height:80px;border-radius:50%;background-color:#3b82f61a;color:#3b82f6;margin-bottom:24px}.appointments[_ngcontent-%COMP%]{padding:20px;display:flex;align-items:center;justify-content:center}@media (max-width: 479px){.appointments[_ngcontent-%COMP%]{padding:16px}}.appointments__grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px}@media (max-width: 479px){.appointments__grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:18px}}@media (min-width: 480px) and (max-width: 767px){.appointments__grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(256px,1fr))}}@media (max-width: 479px){.appointments__grid[_ngcontent-%COMP%]{gap:16px}}.appointment-card[_ngcontent-%COMP%]{overflow:hidden;background-color:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;transition:all .2s ease}.appointment-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 10px 25px #00000026}@media (prefers-reduced-motion: reduce){.appointment-card[_ngcontent-%COMP%]:hover{transform:none}}.appointment-card__header[_ngcontent-%COMP%]{padding:16px;background-color:#3b82f61a;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between}@media (max-width: 479px){.appointment-card__header[_ngcontent-%COMP%]{padding:12px}}.appointment-card__date[_ngcontent-%COMP%]{align-items:center}.appointment-card__date[_ngcontent-%COMP%]{display:flex;flex-direction:column}.appointment-card__day-name[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:#3b82f6;text-transform:uppercase}@media (max-width: 479px){.appointment-card__day-name[_ngcontent-%COMP%]{font-size:11px}}.appointment-card__day[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#3b82f6;line-height:1}@media (max-width: 479px){.appointment-card__day[_ngcontent-%COMP%]{font-size:20px}}.appointment-card__month[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#3b82f6;text-transform:capitalize}@media (max-width: 479px){.appointment-card__month[_ngcontent-%COMP%]{font-size:12px}}.appointment-card__time[_ngcontent-%COMP%]{color:#3b82f6;font-weight:500}.appointment-card__time[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.appointment-card__time[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:#3b82f6;width:20px;height:20px}@media (max-width: 479px){.appointment-card__time[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:18px;height:18px}}@media (max-width: 479px){.appointment-card__time[_ngcontent-%COMP%]{font-size:14px}}.appointment-card__body[_ngcontent-%COMP%]{padding:16px}@media (max-width: 479px){.appointment-card__body[_ngcontent-%COMP%]{padding:12px}}.appointment-card__specialty[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:0 0 16px;color:#1f2937}@media (max-width: 479px){.appointment-card__specialty[_ngcontent-%COMP%]{font-size:16px;margin-bottom:12px}}.appointment-card__doctor[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]{margin-bottom:12px;color:#6b7280;font-size:14px}.appointment-card__doctor[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.appointment-card__doctor[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:#9ca3af;width:18px;height:18px}@media (max-width: 479px){.appointment-card__doctor[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:16px;height:16px}}@media (max-width: 479px){.appointment-card__doctor[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]{font-size:13px;margin-bottom:8px}}.appointment-card__status[_ngcontent-%COMP%]{margin-top:12px}@media (max-width: 479px){.appointment-card__status[_ngcontent-%COMP%]{margin-top:8px}}.appointment-card__footer[_ngcontent-%COMP%]{padding:16px;border-top:1px solid #e5e7eb}.appointment-card__footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:12px}@media (max-width: 479px){.appointment-card__footer[_ngcontent-%COMP%]{padding:12px;gap:8px;flex-direction:column;align-items:stretch}}.appointment-card[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{display:inline-block;padding:6px 12px;border-radius:6px;font-size:12px;font-weight:500;text-transform:capitalize}.appointment-card[_ngcontent-%COMP%]   .status-badge.status-waiting[_ngcontent-%COMP%]{background-color:#f59e0b1a;color:#f59e0b}.appointment-card[_ngcontent-%COMP%]   .status-badge.status-completed[_ngcontent-%COMP%]{background-color:#10b9811a;color:#10b981}.appointment-card[_ngcontent-%COMP%]   .status-badge.status-cancelled[_ngcontent-%COMP%]{background-color:#ef44441a;color:#ef4444}@media (max-width: 479px){.appointment-card[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{font-size:11px;padding:4px 8px}}@media (max-width: 479px){.appointment-card[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%;justify-content:center}}.appointment-card[_ngcontent-%COMP%]   .btn--outline[_ngcontent-%COMP%]{color:#3b82f6;border-color:#3b82f6}.appointment-card[_ngcontent-%COMP%]   .btn--outline[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.appointment-card[_ngcontent-%COMP%]   .btn--outline[_ngcontent-%COMP%]:hover{background-color:#3b82f61a}.appointment-card[_ngcontent-%COMP%]   .btn--outline[disabled][_ngcontent-%COMP%]{color:#9ca3af;border-color:#e5e7eb;cursor:not-allowed}.appointment-card[_ngcontent-%COMP%]   .btn--danger[_ngcontent-%COMP%]{border-color:#ef4444}.appointment-card[_ngcontent-%COMP%]   .btn--danger[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.appointment-card[_ngcontent-%COMP%]   .btn--danger[_ngcontent-%COMP%]:hover{background-color:#ef44441a}.appointment-card[_ngcontent-%COMP%]   .btn--danger[disabled][_ngcontent-%COMP%]{color:#9ca3af;border-color:#e5e7eb;cursor:not-allowed}.empty-state[_ngcontent-%COMP%]{padding:60px 20px;text-align:center;background-color:#f9fafb;border-radius:8px;box-shadow:0 1px 3px #0000001a;display:flex;align-items:center;justify-content:center}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]{padding:40px 16px}}.empty-state__icon[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background-color:#3b82f61a;color:#3b82f6;margin-bottom:24px;display:flex;align-items:center;justify-content:center}.empty-state__icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:40px;height:40px}@media (max-width: 479px){.empty-state__icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:32px;height:32px}}@media (max-width: 479px){.empty-state__icon[_ngcontent-%COMP%]{width:64px;height:64px;margin-bottom:16px}}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0 0 8px;color:#1f2937}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px}}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;margin:0 0 24px}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;margin-bottom:16px}}.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#1d4ed8)}.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]:hover{background-color:#2563eb}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]{width:100%}}.loading-spinner[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#1f2937}.loading-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column}.loading-spinner[_ngcontent-%COMP%]   .loading-icon[_ngcontent-%COMP%]{font-size:2rem;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:.5rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{G as AppointmentsComponent};
