import{a as v}from"./chunk-VO6ML35U.js";import{a as b}from"./chunk-6AOGYQP4.js";import{a as m}from"./chunk-PC5HHMPZ.js";import{a as g,d as S}from"./chunk-J2GLTX2R.js";import{a as p,c as u}from"./chunk-GGYCCLGV.js";import{B as i,R as D,W as E,aa as d,k as h,l,p as n}from"./chunk-VYPP3LKO.js";var a={GET_ALL:"medic/doctors/",GET_BY_ID:o=>`medic/doctors/${o}/`,GET_ME:"medic/doctors/me",GET_PATIENTS:o=>`medic/doctors/${o}/patients`,GET_STATS:o=>`medic/doctors/${o}/stats`,CREATE:"medic/doctors/add/",DELETE:o=>`medic/doctors/delete/${o}/`,DELETE_SCHEDULE:(o,e)=>`medic/doctors/delete/${o}/schedule/${e}/`,UPDATE:o=>`medic/doctors/update/${o}/`,UPDATE_SPECIALITY:o=>`medic/doctors/update/${o}/speciality`,UPDATE_PASSWORD:o=>`medic/doctors/update/${o}/password`,ADD_SCHEDULE:"medic/doctors/add/schedule/",BAN:o=>`medic/doctors/ban/${o}/`,UNBAN:o=>`medic/doctors/unban/${o}/`};var f=class o{apiService=d(S);http=d(u);logger=d(g);storage=d(m);serviceService=d(b);scheduleCache={};getDoctors(){return this.apiService.get(a.GET_ALL).pipe(n(e=>e||[]),i(e=>this.handleError(e,"Failed to fetch doctors")))}getDoctorPatients(e){return this.apiService.get(a.GET_PATIENTS(e)).pipe(i(r=>this.handleError(r,`Failed to fetch doctor ${e}`)))}getDoctorStats(e){return this.apiService.get(a.GET_STATS(e)).pipe(i(r=>this.handleError(r,`Failed to fetch doctor ${e}`)))}getDoctorsBySpeciality(e){let r=new p().set("speciality_id",e);return this.apiService.get(a.GET_ALL,{params:r}).pipe(n(t=>t||[]),i(t=>this.handleError(t,`Failed to fetch doctors for speciality ${e}`)))}getAvailableSchedules(e,r){let t=r?`${e}_${r}`:`${e}`;return this.scheduleCache[t]?h(this.scheduleCache[t]):this.serviceService.getServiceById(e).pipe(D(s=>{if(!s)return l(()=>new Error(`Service ${e} not found`));let T=new p().set("specialty_id",s.specialty_id).set("date",r||"");return this.apiService.get(v.GET_ALL,{params:T}).pipe(n(c=>c.filter(_=>_.doctors?.length>0)),n(c=>(this.scheduleCache[t]=c||[],c)),i(c=>this.handleError(c,`Failed to fetch schedules for service ${e}`)))}))}getDoctorById(e){return this.apiService.get(a.GET_BY_ID(e)).pipe(i(r=>this.handleError(r,`Failed to fetch doctor ${e}`)))}getMe(){return this.apiService.get(a.GET_ME).pipe(i(e=>this.handleError(e,"Failed to fetch authenticated doctor")))}createDoctor(e){return this.apiService.post(a.CREATE,e).pipe(i(r=>this.handleError(r,"Failed to create doctor")))}deleteDoctor(e){return this.apiService.delete(a.DELETE(e)).pipe(i(r=>this.handleError(r,`Failed to delete doctor ${e}`)))}deleteDoctorSchedule(e,r){return this.apiService.delete(a.DELETE_SCHEDULE(e,r)).pipe(i(t=>this.handleError(t,`Failed to delete schedule ${r} for doctor ${e}`)))}updateDoctor(e,r){let t={username:r.username,first_name:r.first_name,last_name:r.last_name,telephone:r.telephone,email:r.email};return this.apiService.patch(a.UPDATE(e),t).pipe(n(s=>(console.log("Respuesta de updateDoctor:",s),s)),i(s=>this.handleError(s,`Failed to update doctor ${e}`)))}updateDoctorSpeciality(e,r){return this.apiService.patch(a.UPDATE_SPECIALITY(e),{speciality_id:r}).pipe(i(t=>this.handleError(t,`Failed to update speciality for doctor ${e}`)))}updateDoctorPassword(e,r){let t=new FormData;return t.append("password",r.password),this.apiService.patch(a.UPDATE_PASSWORD(e),t).pipe(i(s=>this.handleError(s,`Failed to update password for doctor ${e}`)))}addSchedule(e,r){let t=new p().set("doc_id",e).set("schedule_id",r);return this.apiService.patch(a.ADD_SCHEDULE,{},{params:t}).pipe(i(s=>this.handleError(s,`Failed to add schedule ${r} to doctor ${e}`)))}banDoctor(e){return this.apiService.patch(a.BAN(e),{}).pipe(i(r=>this.handleError(r,`Failed to ban doctor ${e}`)))}unbanDoctor(e){return this.apiService.patch(a.UNBAN(e),{}).pipe(i(r=>this.handleError(r,`Failed to unban doctor ${e}`)))}getDayOfWeek(e){let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t=new Date(e);return r[t.getDay()]}handleError(e,r){let t="Ocurri\xF3 un error inesperado. Por favor, intenta de nuevo.";if(e.status)switch(e.status){case 400:t="Solicitud inv\xE1lida. Verifica los datos enviados.";break;case 401:t="No autorizado. Sesi\xF3n expirada.",this.storage.clearStorage();break;case 403:t="No tienes permisos para realizar esta acci\xF3n.";break;case 404:t="Recurso no encontrado.";break;case 500:t="Error interno del servidor. Contacta al soporte.";break}return this.logger.error(`${r}: ${t}`,e),l(()=>new Error(t))}static \u0275fac=function(r){return new(r||o)};static \u0275prov=E({token:o,factory:o.\u0275fac,providedIn:"root"})};export{f as a};
