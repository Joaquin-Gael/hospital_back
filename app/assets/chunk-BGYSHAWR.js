import{c as L,e as R,f as U}from"./chunk-CY6JAXVF.js";import{a as H}from"./chunk-HP6QVOZ5.js";import"./chunk-QMYIRM4F.js";import{a as B}from"./chunk-6JBQLTUK.js";import{a as $}from"./chunk-QPGYGB2T.js";import{a as F}from"./chunk-2DW5HR5M.js";import"./chunk-D7I6PEHK.js";import"./chunk-PC5HHMPZ.js";import"./chunk-LILA3PAH.js";import"./chunk-TYX6CIEY.js";import{a as N}from"./chunk-J2GLTX2R.js";import{d as V}from"./chunk-RASRAAIY.js";import"./chunk-JUPDXIAV.js";import"./chunk-GGYCCLGV.js";import{$b as i,Db as w,Eb as k,Hb as S,Ib as A,Jb as n,Kb as r,Lb as m,Ob as y,Qb as f,Qc as D,Rb as d,S as u,Vc as j,Yc as I,_a as o,aa as c,ac as b,bc as g,f as M,ia as _,ja as x,ka as v,kb as O,la as h,lc as z,nc as E,oc as T,pb as P,yb as l}from"./chunk-VYPP3LKO.js";import"./chunk-4CLCTAJ7.js";var q=(a,e,t)=>({"status-waiting":a,"status-completed":e,"status-cancelled":t});function Y(a,e){a&1&&m(0,"app-loading-spinner",1),a&2&&l("message","Cargando turnos...")}function J(a,e){if(a&1){let t=y();n(0,"div",3)(1,"div",5)(2,"div",6)(3,"span",7),i(4),r(),n(5,"span",8),i(6),r(),n(7,"span",9),i(8),r()(),n(9,"div",10),v(),n(10,"svg",11),m(11,"path",12),r(),i(12),r()(),h(),n(13,"div",13)(14,"h3",14),i(15),r(),n(16,"div",15),v(),n(17,"svg",11),m(18,"path",16),r(),i(19),r(),h(),n(20,"div",17)(21,"span",18),i(22),E(23,"titlecase"),r()()(),n(24,"div",19)(25,"button",20),f("click",function(){let s=_(t).$implicit,C=d(2);return x(C.onReschedule(s.id))}),i(26," Reprogramar "),r(),n(27,"button",21),f("click",function(){let s=_(t).$implicit,C=d(2);return x(C.onCancel(s.turnId))}),i(28," Cancelar "),r()()()}if(a&2){let t=e.$implicit,p=d(2);o(4),b(p.getDayName(t.date)),o(2),b(p.getDayNumber(t.date)),o(2),b(p.getMonthName(t.date)),o(4),g(" ",t.time," "),o(3),g(" ",t.specialty," "),o(4),g(" Doctor: ",t.doctorName," "),o(2),l("ngClass",z(12,q,t.state==="waiting",t.state==="finished",t.state==="cancelled")),o(),g(" ",T(23,10,t.state)," "),o(3),l("disabled",t.state!=="waiting"),o(2),l("disabled",t.state!=="waiting")}}function K(a,e){if(a&1){let t=y();n(0,"div",4)(1,"div",22),v(),n(2,"svg",11),m(3,"path",23),r()(),h(),n(4,"h2"),i(5,"No hay turnos agendados"),r(),n(6,"p"),i(7,"Agenda un nuevo turno para comenzar."),r(),n(8,"button",24),f("click",function(){_(t);let s=d(2);return x(s.onNewAppointment())}),i(9," Agendar turno "),r()()}}function Q(a,e){if(a&1&&(n(0,"div",2),S(1,J,29,16,"div",3,w().trackById,!0,K,10,0,"div",4),r()),a&2){let t=d();o(),A(t.filteredAppointments)}}var G=class a{authService=c($);appointmentService=c(H);logger=c(N);router=c(V);notificationService=c(F);dialog=c(L);appointments=[];user=null;error=null;loading=!0;destroy$=new M;ngOnInit(){if(this.appointments.length>0){this.appointments=this.appointments.filter(e=>e.state=="waiting"),this.loading=this.loading;return}if(!this.authService.isLoggedIn()){this.logger.info("Usuario no autenticado, redirigiendo a /login"),this.router.navigate(["/login"]);return}this.authService.getUser().pipe(u(this.destroy$)).subscribe({next:e=>{if(console.log("User data received:",e),!e){this.error="No se encontraron datos del usuario",this.logger.error("No user data found"),this.router.navigate(["/login"]),this.loading=!1;return}this.user=e,this.loadAppointments(this.user.id)},error:e=>{console.log("Error loading user:",e),this.error="Error al cargar los datos del usuario",this.loading=!1,this.logger.error("Failed to load user",e),this.router.navigate(["/login"])}})}loadAppointments(e){console.log("loadAppointments called with ID:",e),this.loading=!0,this.appointmentService.getTurnsByUserId(e).pipe(u(this.destroy$)).subscribe({next:t=>{console.log("Turns received:",t),this.appointments=this.mapTurnsToAppointments(t),this.loading=!1,this.logger.debug("Appointments loaded successfully",this.appointments)},error:t=>{console.log("Error in loadAppointments:",t),this.error="Error al mostrar los turnos",this.loading=!1,this.logger.error("Error al mostrar los turnos: ",t)}})}mapTurnsToAppointments(e){return e.map(t=>({id:t.appointment_id??t.id,turnId:t.id,date:t.date,time:t.time.split(":").slice(0,2).join(":"),specialty:t.service?.[0]?.name??"Sin especialidad",doctorName:t.doctor?`${t.doctor.first_name} ${t.doctor.last_name}`.trim():"Sin m\xE9dico asignado",state:t.state}))}get filteredAppointments(){return this.appointments.length>0?this.appointments.filter(e=>e.state==="waiting"):this.appointments}onReschedule(e){console.log(`Rescheduling appointment: ${e}`),this.notificationService.info("Reprogramaci\xF3n no implementada")}onCancel(e){this.dialog.open(U,{data:{title:"Cancelar turno",message:"\xBFEst\xE1s seguro de que deseas cancelar este turno?"}}).afterClosed().subscribe(p=>{p&&this.appointmentService.updateTurnState(e,"cancelled").pipe(u(this.destroy$)).subscribe({next:()=>{this.notificationService.success("Turno cancelado correctamente"),this.user?.id&&this.loadAppointments(this.user.id)},error:s=>{this.notificationService.error("Error al cancelar el turno"),this.logger.error("Failed to cancel turn",s)}})})}onNewAppointment(){this.router.navigate(["/shifts"])}getDayName(e){return new Date(e).toLocaleDateString("es-AR",{weekday:"long"}).toLowerCase()}getDayNumber(e){return new Date(e).getDate().toString().padStart(2,"0")}getMonthName(e){return new Date(e).toLocaleDateString("es-AR",{month:"long"}).toLowerCase()}trackById(e,t){return t.id}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=O({type:a,selectors:[["app-appointments"]],decls:3,vars:1,consts:[[1,"appointments"],[3,"message"],[1,"appointments__grid"],[1,"appointment-card"],[1,"empty-state"],[1,"appointment-card__header"],[1,"appointment-card__date"],[1,"appointment-card__day-name"],[1,"appointment-card__day"],[1,"appointment-card__month"],[1,"appointment-card__time"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"icon"],["stroke-linecap","round","stroke-linejoin","round","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"appointment-card__body"],[1,"appointment-card__specialty"],[1,"appointment-card__doctor"],["stroke-linecap","round","stroke-linejoin","round","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"appointment-card__status"],[1,"status-badge",3,"ngClass"],[1,"appointment-card__footer"],[1,"btn","btn--outline","btn--sm",3,"click","disabled"],[1,"btn","btn--danger","btn--sm",3,"click","disabled"],[1,"empty-state__icon"],["stroke-linecap","round","stroke-linejoin","round","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"btn","btn--primary",3,"click"]],template:function(t,p){t&1&&(n(0,"section",0),P(1,Y,1,1,"app-loading-spinner",1)(2,Q,4,1,"div",2),r()),t&2&&(o(),k(p.loading?1:2))},dependencies:[I,D,j,R,B],styles:["[_ngcontent-%COMP%]:root{--user-panel-surface: var(--surface-primary);--user-panel-surface-alt: color-mix(in srgb, var(--surface-primary) 92%, var(--surface-secondary) 8%);--user-panel-surface-muted: color-mix(in srgb, var(--surface-primary) 85%, var(--surface-secondary) 15%);--user-panel-border: var(--border-subtle);--user-panel-border-strong: var(--border-strong);--user-panel-text: var(--text-primary);--user-panel-text-muted: var(--text-secondary);--user-panel-text-soft: var(--text-muted);--user-panel-primary: var(--color-primary);--user-panel-primary-hover: var(--color-primary-hover);--user-panel-primary-dark: var(--color-primary-dark);--user-panel-primary-soft: color-mix(in srgb, var(--color-primary) 12%, transparent 88%);--user-panel-layer-soft: color-mix(in srgb, var(--color-primary) 10%, transparent 90%);--user-panel-layer-strong: color-mix(in srgb, var(--color-primary) 18%, transparent 82%);--user-panel-success: var(--color-success);--user-panel-success-soft: color-mix(in srgb, var(--color-success) 16%, transparent 84%);--user-panel-warning: var(--color-warning);--user-panel-warning-soft: color-mix(in srgb, var(--color-warning) 16%, transparent 84%);--user-panel-danger: var(--color-error);--user-panel-danger-soft: color-mix(in srgb, var(--color-error) 16%, transparent 84%);--user-panel-info: var(--color-info);--user-panel-info-soft: color-mix(in srgb, var(--color-info) 16%, transparent 84%);--user-panel-shadow-sm: var(--shadow-sm);--user-panel-shadow-md: var(--shadow-md);--user-panel-shadow-lg: var(--shadow-lg);--user-panel-focus-ring: var(--focus-ring);--user-panel-overlay: var(--surface-backdrop);--user-panel-navbar-hover: color-mix(in srgb, var(--color-primary) 12%, transparent 88%);--user-panel-navbar-active: color-mix(in srgb, var(--color-primary) 18%, transparent 82%);--user-panel-navbar-border: color-mix(in srgb, var(--color-primary) 25%, transparent 75%);--user-panel-navbar-gradient: var(--gradient-primary);--user-panel-navbar-text: var(--text-primary);--user-panel-footer-shadow: var(--shadow-sm);--user-panel-footer-button-shadow: color-mix(in srgb, var(--color-primary) 20%, transparent 80%)}[data-theme=dark][_ngcontent-%COMP%]{--user-panel-surface-alt: color-mix(in srgb, var(--surface-primary) 88%, var(--surface-secondary) 12%);--user-panel-surface-muted: color-mix(in srgb, var(--surface-primary) 70%, var(--surface-secondary) 30%);--user-panel-navbar-hover: color-mix(in srgb, var(--color-primary) 20%, transparent 80%);--user-panel-navbar-active: color-mix(in srgb, var(--color-primary) 28%, transparent 72%);--user-panel-footer-shadow: var(--shadow-md)}.icon[_ngcontent-%COMP%]{width:20px;height:20px;stroke-width:2}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;border-radius:var(--border-radius-sm);font-weight:500;font-size:14px;cursor:pointer;transition:var(--transition-smooth);border:none;color:var(--text-white)}.btn--primary[_ngcontent-%COMP%]{color:var(--text-white);background:linear-gradient(135deg,var(--user-panel-primary) 0%,var(--user-panel-primary-dark) 100%)}.btn--outline[_ngcontent-%COMP%]{background-color:transparent;color:var(--user-panel-text);border:1px solid var(--user-panel-border)}.btn--outline[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-surface)}.btn--danger[_ngcontent-%COMP%]{background-color:var(--user-panel-danger);color:var(--text-white)}.btn--danger[_ngcontent-%COMP%]:hover{background-color:color-mix(in srgb,var(--user-panel-danger) 95%,black 5%)}.btn--sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.btn[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:16px;height:16px}.btn-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background-color:transparent;color:var(--user-panel-text-muted);border:none;cursor:pointer;transition:var(--transition-smooth)}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.btn-icon[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-surface);color:var(--user-panel-primary)}.btn-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:18px;height:18px}.empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;padding:60px 20px;text-align:center}.empty-state__icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:80px;height:80px;border-radius:50%;background-color:var(--user-panel-layer-soft);color:var(--user-panel-primary);margin-bottom:24px}.appointments[_ngcontent-%COMP%]{padding:20px;display:flex;align-items:center;justify-content:center}@media (max-width: 479px){.appointments[_ngcontent-%COMP%]{padding:16px}}.appointments__grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px}@media (max-width: 479px){.appointments__grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:18px}}@media (min-width: 480px) and (max-width: 767px){.appointments__grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(256px,1fr))}}@media (max-width: 479px){.appointments__grid[_ngcontent-%COMP%]{gap:16px}}.appointment-card[_ngcontent-%COMP%]{overflow:hidden;background-color:var(--user-panel-surface-alt);border-radius:var(--border-radius-md);box-shadow:var(--user-panel-shadow-sm);border:1px solid var(--user-panel-border);transition:var(--transition-smooth)}.appointment-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:var(--user-panel-shadow-lg)}@media (prefers-reduced-motion: reduce){.appointment-card[_ngcontent-%COMP%]:hover{transform:none}}.appointment-card__header[_ngcontent-%COMP%]{padding:16px;background-color:var(--user-panel-layer-soft);border-bottom:1px solid var(--user-panel-border);display:flex;align-items:center;justify-content:space-between}@media (max-width: 479px){.appointment-card__header[_ngcontent-%COMP%]{padding:12px}}.appointment-card__date[_ngcontent-%COMP%]{align-items:center}.appointment-card__date[_ngcontent-%COMP%]{display:flex;flex-direction:column}.appointment-card__day-name[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:var(--user-panel-primary);text-transform:uppercase}@media (max-width: 479px){.appointment-card__day-name[_ngcontent-%COMP%]{font-size:11px}}.appointment-card__day[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:var(--user-panel-primary);line-height:1}@media (max-width: 479px){.appointment-card__day[_ngcontent-%COMP%]{font-size:20px}}.appointment-card__month[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:var(--user-panel-primary);text-transform:capitalize}@media (max-width: 479px){.appointment-card__month[_ngcontent-%COMP%]{font-size:12px}}.appointment-card__time[_ngcontent-%COMP%]{color:var(--user-panel-primary);font-weight:500}.appointment-card__time[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.appointment-card__time[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:var(--user-panel-primary);width:20px;height:20px}@media (max-width: 479px){.appointment-card__time[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:18px;height:18px}}@media (max-width: 479px){.appointment-card__time[_ngcontent-%COMP%]{font-size:14px}}.appointment-card__body[_ngcontent-%COMP%]{padding:16px}@media (max-width: 479px){.appointment-card__body[_ngcontent-%COMP%]{padding:12px}}.appointment-card__specialty[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:0 0 16px;color:var(--user-panel-text)}@media (max-width: 479px){.appointment-card__specialty[_ngcontent-%COMP%]{font-size:16px;margin-bottom:12px}}.appointment-card__doctor[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]{margin-bottom:12px;color:var(--user-panel-text-muted);font-size:14px}.appointment-card__doctor[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.appointment-card__doctor[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:var(--user-panel-text-soft);width:18px;height:18px}@media (max-width: 479px){.appointment-card__doctor[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:16px;height:16px}}@media (max-width: 479px){.appointment-card__doctor[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]{font-size:13px;margin-bottom:8px}}.appointment-card__status[_ngcontent-%COMP%]{margin-top:12px}@media (max-width: 479px){.appointment-card__status[_ngcontent-%COMP%]{margin-top:8px}}.appointment-card__footer[_ngcontent-%COMP%]{padding:16px;border-top:1px solid var(--user-panel-border)}.appointment-card__footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:12px}@media (max-width: 479px){.appointment-card__footer[_ngcontent-%COMP%]{padding:12px;gap:8px;flex-direction:column;align-items:stretch}}.appointment-card[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{display:inline-block;padding:6px 12px;border-radius:var(--border-radius-sm);font-size:12px;font-weight:500;text-transform:capitalize}.appointment-card[_ngcontent-%COMP%]   .status-badge.status-waiting[_ngcontent-%COMP%]{background-color:color-mix(in srgb,var(--user-panel-warning) 10%,transparent 90%);color:var(--user-panel-warning)}.appointment-card[_ngcontent-%COMP%]   .status-badge.status-completed[_ngcontent-%COMP%]{background-color:color-mix(in srgb,var(--user-panel-success) 10%,transparent 90%);color:var(--user-panel-success)}.appointment-card[_ngcontent-%COMP%]   .status-badge.status-cancelled[_ngcontent-%COMP%]{background-color:color-mix(in srgb,var(--user-panel-danger) 10%,transparent 90%);color:var(--user-panel-danger)}@media (max-width: 479px){.appointment-card[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{font-size:11px;padding:4px 8px}}@media (max-width: 479px){.appointment-card[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%;justify-content:center}}.appointment-card[_ngcontent-%COMP%]   .btn--outline[_ngcontent-%COMP%]{color:var(--user-panel-primary);border-color:var(--user-panel-primary)}.appointment-card[_ngcontent-%COMP%]   .btn--outline[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.appointment-card[_ngcontent-%COMP%]   .btn--outline[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-layer-soft)}.appointment-card[_ngcontent-%COMP%]   .btn--outline[disabled][_ngcontent-%COMP%]{color:var(--user-panel-text-soft);border-color:var(--user-panel-border);cursor:not-allowed}.appointment-card[_ngcontent-%COMP%]   .btn--danger[_ngcontent-%COMP%]{border-color:var(--user-panel-danger)}.appointment-card[_ngcontent-%COMP%]   .btn--danger[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.appointment-card[_ngcontent-%COMP%]   .btn--danger[_ngcontent-%COMP%]:hover{background-color:color-mix(in srgb,var(--user-panel-danger) 10%,transparent 90%)}.appointment-card[_ngcontent-%COMP%]   .btn--danger[disabled][_ngcontent-%COMP%]{color:var(--user-panel-text-soft);border-color:var(--user-panel-border);cursor:not-allowed}.empty-state[_ngcontent-%COMP%]{padding:60px 20px;text-align:center;background-color:var(--user-panel-surface);border-radius:var(--border-radius-md);box-shadow:var(--user-panel-shadow-sm);display:flex;align-items:center;justify-content:center}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]{padding:40px 16px}}.empty-state__icon[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background-color:var(--user-panel-layer-soft);color:var(--user-panel-primary);margin-bottom:24px;display:flex;align-items:center;justify-content:center}.empty-state__icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:40px;height:40px}@media (max-width: 479px){.empty-state__icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:32px;height:32px}}@media (max-width: 479px){.empty-state__icon[_ngcontent-%COMP%]{width:64px;height:64px;margin-bottom:16px}}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0 0 8px;color:var(--user-panel-text)}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px}}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:var(--user-panel-text-muted);margin:0 0 24px}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;margin-bottom:16px}}.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--user-panel-primary) 0%,var(--user-panel-primary-dark) 100%)}.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-primary-dark)}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]{width:100%}}.loading-spinner[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--user-panel-text)}.loading-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column}.loading-spinner[_ngcontent-%COMP%]   .loading-icon[_ngcontent-%COMP%]{font-size:2rem;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:.5rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{G as AppointmentsComponent};
