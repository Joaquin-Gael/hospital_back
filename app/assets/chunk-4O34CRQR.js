import{a as ae,b as ie,c as se,d as le,e as pe,f as ce,g as z,h as ue}from"./chunk-MWWWPAY4.js";import{a as fe,b as ve}from"./chunk-XS3J3KOC.js";import{a as _e}from"./chunk-5GFEN4HN.js";import{a as xe}from"./chunk-J645FM4T.js";import"./chunk-VO6ML35U.js";import"./chunk-QMYIRM4F.js";import{a as he}from"./chunk-KOR7JQL3.js";import"./chunk-RYO32FGU.js";import{a as K}from"./chunk-FG3VCKV6.js";import{a as ge}from"./chunk-SLWJMPZV.js";import"./chunk-2KUBWO5M.js";import"./chunk-4W6XZAEZ.js";import{q as de,r as me}from"./chunk-LZ2CXPXV.js";import"./chunk-M3FKVPZN.js";import{a as J}from"./chunk-3F3ZFDNX.js";import{d as Y}from"./chunk-7KU7TUXL.js";import"./chunk-AT6ZLWLU.js";import"./chunk-SHF7GFMJ.js";import{c as Q,e as V,f as X,g as Z,k as ee,n as te,o as ne,u as re,w as oe}from"./chunk-CXCZTUTO.js";import{$a as l,Eb as N,Fb as O,Ib as $,Jb as H,Kb as o,Lb as i,Mb as u,Pb as b,Rb as f,Rc as U,S as m,Sb as c,Wc as W,Zc as T,aa as d,ac as s,bc as C,cc as P,eb as j,f as w,ja as x,ka as _,la as S,lb as k,ma as D,mc as G,oc as B,pc as q,qb as M,zb as g}from"./chunk-U346BHW4.js";import{a as L}from"./chunk-4CLCTAJ7.js";function De(a,t){a&1&&(o(0,"mat-dialog-content")(1,"div",3)(2,"i",4),s(3,"hourglass_empty"),i(),o(4,"span"),s(5,"Cargando horarios disponibles..."),i()()())}function ke(a,t){if(a&1){let e=b();o(0,"mat-dialog-content")(1,"div",5)(2,"p"),s(3),i()()(),o(4,"mat-dialog-actions",6)(5,"button",7),f("click",function(){x(e);let r=c();return _(r.onCancel())}),s(6,"Cerrar"),i()()}if(a&2){let e=c();l(3),C(e.error)}}function Te(a,t){if(a&1&&u(0,"app-time-selection",11),a&2){let e=c(2);g("timeControl",e.timeControl)("availableTimeSlots",e.availableTimeSlots)("isLoading",e.isLoading)("error",e.error)}}function ze(a,t){if(a&1){let e=b();o(0,"form",8),f("ngSubmit",function(){x(e);let r=c();return _(r.onSubmit())}),o(1,"mat-dialog-content")(2,"div",9),u(3,"app-date-selection",10),M(4,Te,1,4,"app-time-selection",11),o(5,"div",12)(6,"label",13),s(7,"Motivo (opcional)"),i(),u(8,"textarea",14),i()()(),o(9,"mat-dialog-actions",6)(10,"button",7),f("click",function(){x(e);let r=c();return _(r.onCancel())}),s(11,"Cancelar"),i(),o(12,"button",15),s(13," Confirmar reprogramaci\xF3n "),i()()()}if(a&2){let e=c();g("formGroup",e.form),l(3),g("dateControl",e.dateControl)("minDate",e.minDate)("dayFilter",e.dayFilter)("isLoading",e.isLoading)("error",e.error),l(),O(e.availableTimeSlots.length>0?4:-1),l(8),g("disabled",e.form.invalid)}}var A=class a{constructor(t){this.data=t}fb=d(re);dialogRef=d(ae);scheduleService=d(xe);destroy$=new w;form;availableDays=[];availableTimeSlots=[];schedules=[];isLoading=!0;error=null;minDate=new Date;ngOnInit(){if(this.initForm(),!this.data.specialtyId){this.error="No se proporcion\xF3 la especialidad",this.isLoading=!1,console.error("Missing specialtyId in dialog data");return}this.loadAvailableDays(this.data.specialtyId),this.watchFormChanges()}initForm(){let t=null;if(this.data?.currentDate){let e=this.data.currentDate.split("-");e.length===3&&(t=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2])))}this.form=this.fb.group({appointmentDate:[t,V.required],appointmentTime:[this.data?.currentTime?.substring(0,5)??"",V.required],reason:[""]})}watchFormChanges(){this.form.get("appointmentDate")?.valueChanges.pipe(m(this.destroy$)).subscribe(t=>{t?this.generateTimeSlots(t):(this.availableTimeSlots=[],this.form.get("appointmentTime")?.setValue(null))})}loadAvailableDays(t){console.log("\u{1F50D} Loading schedules for specialty:",t),this.scheduleService.getAvailableDays(t).pipe(m(this.destroy$)).subscribe({next:e=>{console.log("\u2705 Specialty schedules loaded:",e),this.schedules=e.available_days.map(r=>({day:r.day,start_time:r.start_time,end_time:r.end_time})),this.availableDays=[...new Set(this.schedules.map(r=>r.day))],this.isLoading=!1,console.log("\u{1F4C5} Available days:",this.availableDays);let n=this.form.get("appointmentDate")?.value;n&&this.generateTimeSlots(n)},error:e=>{console.error("\u274C Error loading schedules:",e),this.error="Error al cargar los horarios disponibles",this.isLoading=!1}})}generateTimeSlots(t){let e=t.toLocaleDateString("es-ES",{weekday:"long"}).toLowerCase(),r={lunes:"monday",martes:"tuesday",mi\u00E9rcoles:"wednesday",jueves:"thursday",viernes:"friday",s\u00E1bado:"saturday",domingo:"sunday"}[e]||"";console.log("\u{1F5D3}\uFE0F Selected date:",t,"\u2192 Day:",r);let p=this.schedules.filter(h=>h.day.toLowerCase()===r.toLowerCase());if(console.log("\u{1F50D} Matching schedules for",r,":",p),!p.length){this.availableTimeSlots=[],this.form.get("appointmentTime")?.setValue(null),console.warn("\u26A0\uFE0F No schedules found for",r);return}let v=p.flatMap(h=>this.generateTimeIntervals(h.start_time,h.end_time,t));this.availableTimeSlots=[...new Set(v)].sort((h,E)=>h.localeCompare(E)),console.log("\u23F0 Available time slots:",this.availableTimeSlots)}generateTimeIntervals(t,e,n,r=30){let p=[],[v,h]=t.split(":").slice(0,2).map(Number),[E,Ce]=e.split(":").slice(0,2).map(Number),R=new Date;R.setHours(v,h,0,0);let F=new Date;F.setHours(E,Ce,0,0);let ye=new Date,Me=this.isSameDay(n,ye),y=R;if(Me){let I=new Date;if(I>R){let Oe=I.getMinutes(),Pe=Math.ceil((Oe+1)/r)*r;y.setHours(I.getHours(),Pe,0,0)}}for(;y<F;)p.push(this.formatTime(y)),y=new Date(y.getTime()+r*60*1e3);return p}isSameDay(t,e){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}formatTime(t){return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:00`}dayFilter=t=>{if(!t)return!1;let e=new Date;if(e.setHours(0,0,0,0),t<e||!this.availableDays.length)return!1;let n={lunes:"monday",martes:"tuesday",mi\u00E9rcoles:"wednesday",jueves:"thursday",viernes:"friday",s\u00E1bado:"saturday",domingo:"sunday"},r=t.toLocaleDateString("es-ES",{weekday:"long"}).toLowerCase(),p=n[r]||"";return this.availableDays.some(v=>v.toLowerCase()===p.toLowerCase())};onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}let t=this.form.value,e=typeof t.reason=="string"&&t.reason.trim().length>0?t.reason.trim():void 0,n=L({date:this.formatDateISO(t.appointmentDate),time:this.ensureSeconds(t.appointmentTime)},e?{reason:e}:{});console.log("\u{1F4E4} Submitting reschedule request:",n),this.dialogRef.close(n)}onCancel(){this.dialogRef.close(void 0)}formatDateISO(t){return t.toISOString().split("T")[0]}ensureSeconds(t){return t&&(t.length===5?`${t}:00`:t)}get dateControl(){return this.form.get("appointmentDate")}get timeControl(){return this.form.get("appointmentTime")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||a)(j(ie))};static \u0275cmp=k({type:a,selectors:[["app-reschedule-turn-dialog"]],decls:6,vars:1,consts:[[1,"reschedule-dialog"],["mat-dialog-title",""],[3,"formGroup"],[1,"loading-spinner"],[1,"material-icons","loading-icon"],[1,"error-message"],["align","end"],["mat-button","","type","button",3,"click"],[3,"ngSubmit","formGroup"],[1,"dialog-content"],[3,"dateControl","minDate","dayFilter","isLoading","error"],[3,"timeControl","availableTimeSlots","isLoading","error"],[1,"form-field"],["for","reschedule-reason"],["id","reschedule-reason","rows","3","formControlName","reason","placeholder","Escribe un motivo para reprogramar (opcional)"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"h2",1),s(2,"Reprogramar turno"),i(),M(3,De,6,0,"mat-dialog-content")(4,ke,7,1)(5,ze,14,8,"form",2),i()),e&2&&(l(3),O(n.isLoading?3:n.error?4:5))},dependencies:[T,oe,ee,Q,X,Z,te,ne,z,le,ce,pe,me,de,fe,ve],styles:["[_ngcontent-%COMP%]:root{--user-panel-surface: var(--surface-primary);--user-panel-surface-alt: color-mix(in srgb, var(--surface-primary) 92%, var(--surface-secondary) 8%);--user-panel-surface-muted: color-mix(in srgb, var(--surface-primary) 85%, var(--surface-secondary) 15%);--user-panel-border: var(--border-subtle);--user-panel-border-strong: var(--border-strong);--user-panel-text: var(--text-primary);--user-panel-text-muted: var(--text-secondary);--user-panel-text-soft: var(--text-muted);--user-panel-primary: var(--color-primary);--user-panel-primary-hover: var(--color-primary-hover);--user-panel-primary-dark: var(--color-primary-dark);--user-panel-primary-soft: color-mix(in srgb, var(--color-primary) 12%, transparent 88%);--user-panel-layer-soft: color-mix(in srgb, var(--color-primary) 10%, transparent 90%);--user-panel-layer-strong: color-mix(in srgb, var(--color-primary) 18%, transparent 82%);--user-panel-success: var(--color-success);--user-panel-success-soft: color-mix(in srgb, var(--color-success) 16%, transparent 84%);--user-panel-warning: var(--color-warning);--user-panel-warning-soft: color-mix(in srgb, var(--color-warning) 16%, transparent 84%);--user-panel-danger: var(--color-error);--user-panel-danger-soft: color-mix(in srgb, var(--color-error) 16%, transparent 84%);--user-panel-info: var(--color-info);--user-panel-info-soft: color-mix(in srgb, var(--color-info) 16%, transparent 84%);--user-panel-shadow-sm: var(--shadow-sm);--user-panel-shadow-md: var(--shadow-md);--user-panel-shadow-lg: var(--shadow-lg);--user-panel-focus-ring: var(--focus-ring);--user-panel-overlay: var(--surface-backdrop);--user-panel-navbar-hover: color-mix(in srgb, var(--color-primary) 12%, transparent 88%);--user-panel-navbar-active: color-mix(in srgb, var(--color-primary) 18%, transparent 82%);--user-panel-navbar-border: color-mix(in srgb, var(--color-primary) 25%, transparent 75%);--user-panel-navbar-gradient: var(--gradient-primary);--user-panel-navbar-text: var(--text-primary);--user-panel-footer-shadow: var(--shadow-sm);--user-panel-footer-button-shadow: color-mix(in srgb, var(--color-primary) 20%, transparent 80%)}[data-theme=dark][_ngcontent-%COMP%]{--user-panel-surface-alt: color-mix(in srgb, var(--surface-primary) 88%, var(--surface-secondary) 12%);--user-panel-surface-muted: color-mix(in srgb, var(--surface-primary) 70%, var(--surface-secondary) 30%);--user-panel-navbar-hover: color-mix(in srgb, var(--color-primary) 20%, transparent 80%);--user-panel-navbar-active: color-mix(in srgb, var(--color-primary) 28%, transparent 72%);--user-panel-footer-shadow: var(--shadow-md)}.icon[_ngcontent-%COMP%]{width:20px;height:20px;stroke-width:2}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;border-radius:var(--border-radius-sm);font-weight:500;font-size:14px;cursor:pointer;transition:var(--transition-smooth);border:none;color:var(--text-white)}.btn--primary[_ngcontent-%COMP%]{color:var(--text-white);background:linear-gradient(135deg,var(--user-panel-primary) 0%,var(--user-panel-primary-dark) 100%)}.btn--outline[_ngcontent-%COMP%]{background-color:transparent;color:var(--user-panel-text);border:1px solid var(--user-panel-border)}.btn--outline[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-surface)}.btn--danger[_ngcontent-%COMP%]{background-color:var(--user-panel-danger);color:var(--text-white)}.btn--danger[_ngcontent-%COMP%]:hover{background-color:color-mix(in srgb,var(--user-panel-danger) 95%,black 5%)}.btn--sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.btn[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:16px;height:16px}.btn-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background-color:transparent;color:var(--user-panel-text-muted);border:none;cursor:pointer;transition:var(--transition-smooth)}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.btn-icon[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-surface);color:var(--user-panel-primary)}.btn-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:18px;height:18px}.empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;padding:60px 20px;text-align:center}.empty-state__icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:80px;height:80px;border-radius:50%;background-color:var(--user-panel-layer-soft);color:var(--user-panel-primary);margin-bottom:24px}.empty-state__icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:40px;height:40px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0 0 8px;color:var(--user-panel-text)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:var(--user-panel-text-muted);margin:0 0 24px}.reschedule-dialog[_ngcontent-%COMP%]{min-width:500px;max-width:600px}.reschedule-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media (max-width: 479px){.reschedule-dialog[_ngcontent-%COMP%]{min-width:unset;max-width:100%}}@media (min-width: 480px) and (max-width: 767px){.reschedule-dialog[_ngcontent-%COMP%]{min-width:400px}}h2[mat-dialog-title][_ngcontent-%COMP%]{margin:0;padding:1.5rem 1.5rem 1rem;font-size:1.5rem;font-weight:600;color:var(--user-panel-text)}@media (max-width: 479px){h2[mat-dialog-title][_ngcontent-%COMP%]{font-size:1.25rem;padding:1.25rem 1rem .75rem}}mat-dialog-content[_ngcontent-%COMP%]{padding:0 1.5rem;max-height:70vh;overflow-y:auto}@media (max-width: 479px){mat-dialog-content[_ngcontent-%COMP%]{padding:0 1rem;max-height:60vh}}mat-dialog-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}mat-dialog-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--user-panel-surface-muted);border-radius:var(--border-radius-sm)}mat-dialog-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--user-panel-text-soft);border-radius:var(--border-radius-sm)}mat-dialog-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--user-panel-text-muted)}.dialog-content[_ngcontent-%COMP%]{gap:1.5rem;padding:1rem 0}.dialog-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media (max-width: 479px){.dialog-content[_ngcontent-%COMP%]{gap:1.25rem;padding:.75rem 0}}.form-field[_ngcontent-%COMP%]{gap:.5rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500;color:var(--user-panel-text)}@media (max-width: 479px){.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.9rem}}.form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:1px solid var(--user-panel-border);border-radius:var(--border-radius-sm);padding:.75rem;font-size:.95rem;font-family:inherit;resize:vertical;min-height:4rem;transition:var(--transition-smooth);background-color:var(--user-panel-surface);color:var(--user-panel-text)}@media (max-width: 479px){.form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{font-size:.875rem;padding:.625rem;min-height:3.5rem}}.form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--user-panel-primary);background-color:var(--user-panel-surface-alt);box-shadow:0 0 0 3px var(--user-panel-primary-soft)}.form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:var(--user-panel-text-soft)}.form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:var(--user-panel-surface-muted);cursor:not-allowed;opacity:.6}mat-dialog-actions[_ngcontent-%COMP%]{padding:1rem 1.5rem 1.5rem}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:.5rem}@media (max-width: 479px){mat-dialog-actions[_ngcontent-%COMP%]{padding:.75rem 1rem 1rem;flex-direction:column-reverse;gap:.75rem}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}.loading-spinner[_ngcontent-%COMP%]{gap:1rem;padding:2rem;color:var(--user-panel-text-muted);display:flex;align-items:center;justify-content:center}.loading-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media (max-width: 479px){.loading-spinner[_ngcontent-%COMP%]{padding:1.5rem}}.loading-spinner[_ngcontent-%COMP%]   .loading-icon[_ngcontent-%COMP%]{font-size:2.5rem;animation:_ngcontent-%COMP%_spin 1s linear infinite;color:var(--user-panel-primary)}@media (max-width: 479px){.loading-spinner[_ngcontent-%COMP%]   .loading-icon[_ngcontent-%COMP%]{font-size:2rem}}.loading-spinner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.95rem}@media (max-width: 479px){.loading-spinner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.875rem}}.error-message[_ngcontent-%COMP%]{padding:1rem;background-color:var(--user-panel-danger-soft);border:1px solid var(--user-panel-danger);border-radius:var(--border-radius-md);color:var(--user-panel-danger);text-align:center;font-size:.9rem}@media (max-width: 479px){.error-message[_ngcontent-%COMP%]{padding:.875rem;font-size:.85rem}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (prefers-reduced-motion: reduce){*[_ngcontent-%COMP%], *[_ngcontent-%COMP%]:before, *[_ngcontent-%COMP%]:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}.loading-icon[_ngcontent-%COMP%]{animation:none}}@media (prefers-color-scheme: dark){.form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:var(--user-panel-text-soft)}}@media (prefers-contrast: high){.form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border-width:2px}.form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{border-width:3px}.error-message[_ngcontent-%COMP%]{border-width:2px;font-weight:600}}"]})};var Ae=(a,t,e)=>({"status-waiting":a,"status-completed":t,"status-cancelled":e});function Ee(a,t){a&1&&u(0,"app-loading-spinner",1),a&2&&g("message","Cargando turnos...")}function Re(a,t){if(a&1){let e=b();o(0,"div",3)(1,"div",5)(2,"div",6)(3,"span",7),s(4),i(),o(5,"span",8),s(6),i(),o(7,"span",9),s(8),i()(),o(9,"div",10),S(),o(10,"svg",11),u(11,"path",12),i(),s(12),i()(),D(),o(13,"div",13)(14,"h3",14),s(15),i(),o(16,"div",15),S(),o(17,"svg",11),u(18,"path",16),i(),s(19),i(),D(),o(20,"div",17)(21,"span",18),s(22),B(23,"titlecase"),i()()(),o(24,"div",19)(25,"button",20),f("click",function(){let r=x(e).$implicit,p=c(2);return _(p.onReschedule(r.turnId))}),s(26," Reprogramar "),i(),o(27,"button",21),f("click",function(){let r=x(e).$implicit,p=c(2);return _(p.onCancel(r.turnId))}),s(28," Cancelar "),i()()()}if(a&2){let e=t.$implicit,n=c(2);l(4),C(n.getDayName(e.date)),l(2),C(n.getDayNumber(e.date)),l(2),C(n.getMonthName(e.date)),l(4),P(" ",e.time," "),l(3),P(" ",e.specialty," "),l(4),P(" Doctor: ",e.doctorName," "),l(2),g("ngClass",G(12,Ae,e.state==="waiting",e.state==="finished",e.state==="cancelled")),l(),P(" ",q(23,10,e.state)," "),l(3),g("disabled",e.state!=="waiting"),l(2),g("disabled",e.state!=="waiting")}}function Ie(a,t){if(a&1){let e=b();o(0,"div",4)(1,"div",22),S(),o(2,"svg",11),u(3,"path",23),i()(),D(),o(4,"h2"),s(5,"No hay turnos agendados"),i(),o(6,"p"),s(7,"Agenda un nuevo turno para comenzar."),i(),o(8,"button",24),f("click",function(){x(e);let r=c(2);return _(r.onNewAppointment())}),s(9," Agendar turno "),i()()}}function Ve(a,t){if(a&1&&(o(0,"div",2),$(1,Re,29,16,"div",3,N().trackById,!0,Ie,10,0,"div",4),i()),a&2){let e=c();l(),H(e.filteredAppointments)}}var be=class a{authService=d(K);appointmentService=d(_e);logger=d(J);router=d(Y);notificationService=d(ge);dialog=d(se);appointments=[];user=null;error=null;loading=!0;destroy$=new w;ngOnInit(){if(this.appointments.length>0){this.appointments=this.appointments.filter(t=>t.state=="waiting"),this.loading=this.loading;return}if(!this.authService.isLoggedIn()){this.logger.info("Usuario no autenticado, redirigiendo a /login"),this.router.navigate(["/login"]);return}this.authService.getUser().pipe(m(this.destroy$)).subscribe({next:t=>{if(console.log("User data received:",t),!t){this.error="No se encontraron datos del usuario",this.logger.error("No user data found"),this.router.navigate(["/login"]),this.loading=!1;return}this.user=t,this.loadAppointments(this.user.id)},error:t=>{console.log("Error loading user:",t),this.error="Error al cargar los datos del usuario",this.loading=!1,this.logger.error("Failed to load user",t),this.router.navigate(["/login"])}})}loadAppointments(t){console.log("loadAppointments called with ID:",t),this.loading=!0,this.appointmentService.getTurnsByUserId(t).pipe(m(this.destroy$)).subscribe({next:e=>{console.log("Turns received:",e),this.appointments=this.mapTurnsToAppointments(e),this.loading=!1,this.logger.debug("Appointments loaded successfully",this.appointments)},error:e=>{console.log("Error in loadAppointments:",e),this.error="Error al mostrar los turnos",this.loading=!1,this.logger.error("Error al mostrar los turnos: ",e)}})}mapTurnsToAppointments(t){return t.map(e=>({id:e.appointment_id??e.id,turnId:e.id,date:e.date,time:e.time.split(":").slice(0,2).join(":"),specialty:e.service?.[0]?.name??"Sin especialidad",doctorName:e.doctor?`${e.doctor.first_name} ${e.doctor.last_name}`.trim():"Sin m\xE9dico asignado",state:e.state}))}get filteredAppointments(){return this.appointments.length>0?this.appointments.filter(t=>t.state==="waiting"):this.appointments}onReschedule(t){let e=this.appointments.find(n=>n.turnId===t);this.loading=!0,this.appointmentService.getTurnById(t).pipe(m(this.destroy$)).subscribe({next:n=>{this.loading=!1,this.dialog.open(A,{width:"600px",maxWidth:"95vw",data:{currentDate:n.date,currentTime:n.time,specialtyId:n.service?.[0]?.specialty_id}}).afterClosed().pipe(m(this.destroy$)).subscribe(p=>{p&&(this.loading=!0,this.appointmentService.rescheduleTurn(t,p).pipe(m(this.destroy$)).subscribe({next:()=>{this.notificationService.success("Turno reprogramado correctamente"),this.user?.id?this.loadAppointments(this.user.id):this.loading=!1},error:v=>{this.notificationService.error("Error al reprogramar el turno"),this.logger.error("Failed to reschedule turn",v),this.loading=!1}}))})},error:n=>{this.loading=!1,this.notificationService.error("Error al cargar los datos del turno"),this.logger.error("Failed to load turn details",n)}})}onCancel(t){this.dialog.open(ue,{data:{title:"Cancelar turno",message:"\xBFEst\xE1s seguro de que deseas cancelar este turno?"}}).afterClosed().subscribe(n=>{n&&this.appointmentService.updateTurnState(t,"cancelled").pipe(m(this.destroy$)).subscribe({next:()=>{this.notificationService.success("Turno cancelado correctamente"),this.user?.id&&this.loadAppointments(this.user.id)},error:r=>{this.notificationService.error("Error al cancelar el turno"),this.logger.error("Failed to cancel turn",r)}})})}onNewAppointment(){this.router.navigate(["/shifts"])}getDayName(t){return new Date(t).toLocaleDateString("es-AR",{weekday:"long"}).toLowerCase()}getDayNumber(t){return new Date(t).getDate().toString().padStart(2,"0")}getMonthName(t){return new Date(t).toLocaleDateString("es-AR",{month:"long"}).toLowerCase()}trackById(t,e){return e.id}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-appointments"]],decls:3,vars:1,consts:[[1,"appointments"],[3,"message"],[1,"appointments__grid"],[1,"appointment-card"],[1,"empty-state"],[1,"appointment-card__header"],[1,"appointment-card__date"],[1,"appointment-card__day-name"],[1,"appointment-card__day"],[1,"appointment-card__month"],[1,"appointment-card__time"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"icon"],["stroke-linecap","round","stroke-linejoin","round","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"appointment-card__body"],[1,"appointment-card__specialty"],[1,"appointment-card__doctor"],["stroke-linecap","round","stroke-linejoin","round","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"appointment-card__status"],[1,"status-badge",3,"ngClass"],[1,"appointment-card__footer"],[1,"btn","btn--outline","btn--sm",3,"click","disabled"],[1,"btn","btn--danger","btn--sm",3,"click","disabled"],[1,"empty-state__icon"],["stroke-linecap","round","stroke-linejoin","round","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"btn","btn--primary",3,"click"]],template:function(e,n){e&1&&(o(0,"section",0),M(1,Ee,1,1,"app-loading-spinner",1)(2,Ve,4,1,"div",2),i()),e&2&&(l(),O(n.loading?1:2))},dependencies:[T,U,W,z,he],styles:["[_ngcontent-%COMP%]:root{--user-panel-surface: var(--surface-primary);--user-panel-surface-alt: color-mix(in srgb, var(--surface-primary) 92%, var(--surface-secondary) 8%);--user-panel-surface-muted: color-mix(in srgb, var(--surface-primary) 85%, var(--surface-secondary) 15%);--user-panel-border: var(--border-subtle);--user-panel-border-strong: var(--border-strong);--user-panel-text: var(--text-primary);--user-panel-text-muted: var(--text-secondary);--user-panel-text-soft: var(--text-muted);--user-panel-primary: var(--color-primary);--user-panel-primary-hover: var(--color-primary-hover);--user-panel-primary-dark: var(--color-primary-dark);--user-panel-primary-soft: color-mix(in srgb, var(--color-primary) 12%, transparent 88%);--user-panel-layer-soft: color-mix(in srgb, var(--color-primary) 10%, transparent 90%);--user-panel-layer-strong: color-mix(in srgb, var(--color-primary) 18%, transparent 82%);--user-panel-success: var(--color-success);--user-panel-success-soft: color-mix(in srgb, var(--color-success) 16%, transparent 84%);--user-panel-warning: var(--color-warning);--user-panel-warning-soft: color-mix(in srgb, var(--color-warning) 16%, transparent 84%);--user-panel-danger: var(--color-error);--user-panel-danger-soft: color-mix(in srgb, var(--color-error) 16%, transparent 84%);--user-panel-info: var(--color-info);--user-panel-info-soft: color-mix(in srgb, var(--color-info) 16%, transparent 84%);--user-panel-shadow-sm: var(--shadow-sm);--user-panel-shadow-md: var(--shadow-md);--user-panel-shadow-lg: var(--shadow-lg);--user-panel-focus-ring: var(--focus-ring);--user-panel-overlay: var(--surface-backdrop);--user-panel-navbar-hover: color-mix(in srgb, var(--color-primary) 12%, transparent 88%);--user-panel-navbar-active: color-mix(in srgb, var(--color-primary) 18%, transparent 82%);--user-panel-navbar-border: color-mix(in srgb, var(--color-primary) 25%, transparent 75%);--user-panel-navbar-gradient: var(--gradient-primary);--user-panel-navbar-text: var(--text-primary);--user-panel-footer-shadow: var(--shadow-sm);--user-panel-footer-button-shadow: color-mix(in srgb, var(--color-primary) 20%, transparent 80%)}[data-theme=dark][_ngcontent-%COMP%]{--user-panel-surface-alt: color-mix(in srgb, var(--surface-primary) 88%, var(--surface-secondary) 12%);--user-panel-surface-muted: color-mix(in srgb, var(--surface-primary) 70%, var(--surface-secondary) 30%);--user-panel-navbar-hover: color-mix(in srgb, var(--color-primary) 20%, transparent 80%);--user-panel-navbar-active: color-mix(in srgb, var(--color-primary) 28%, transparent 72%);--user-panel-footer-shadow: var(--shadow-md)}.icon[_ngcontent-%COMP%]{width:20px;height:20px;stroke-width:2}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;border-radius:var(--border-radius-sm);font-weight:500;font-size:14px;cursor:pointer;transition:var(--transition-smooth);border:none;color:var(--text-white)}.btn--primary[_ngcontent-%COMP%]{color:var(--text-white);background:linear-gradient(135deg,var(--user-panel-primary) 0%,var(--user-panel-primary-dark) 100%)}.btn--outline[_ngcontent-%COMP%]{background-color:transparent;color:var(--user-panel-text);border:1px solid var(--user-panel-border)}.btn--outline[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-surface)}.btn--danger[_ngcontent-%COMP%]{background-color:var(--user-panel-danger);color:var(--text-white)}.btn--danger[_ngcontent-%COMP%]:hover{background-color:color-mix(in srgb,var(--user-panel-danger) 95%,black 5%)}.btn--sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.btn[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:16px;height:16px}.btn-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background-color:transparent;color:var(--user-panel-text-muted);border:none;cursor:pointer;transition:var(--transition-smooth)}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.btn-icon[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-surface);color:var(--user-panel-primary)}.btn-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:18px;height:18px}.empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;padding:60px 20px;text-align:center}.empty-state__icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:80px;height:80px;border-radius:50%;background-color:var(--user-panel-layer-soft);color:var(--user-panel-primary);margin-bottom:24px}.appointments[_ngcontent-%COMP%]{padding:20px;display:flex;align-items:center;justify-content:center}@media (max-width: 479px){.appointments[_ngcontent-%COMP%]{padding:16px}}.appointments__grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px}@media (max-width: 479px){.appointments__grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:18px}}@media (min-width: 480px) and (max-width: 767px){.appointments__grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(256px,1fr))}}@media (max-width: 479px){.appointments__grid[_ngcontent-%COMP%]{gap:16px}}.appointment-card[_ngcontent-%COMP%]{overflow:hidden;background-color:var(--user-panel-surface-alt);border-radius:var(--border-radius-md);border:1px solid var(--user-panel-border);box-shadow:var(--user-panel-shadow-sm);transition:background-color var(--transition-smooth),border-color var(--transition-smooth),box-shadow var(--transition-smooth);transition:background-color var(--transition-smooth),border-color var(--transition-smooth),box-shadow var(--transition-smooth),transform var(--transition-smooth);will-change:transform,box-shadow}.appointment-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:var(--user-panel-shadow-lg)}@media (prefers-reduced-motion: reduce){.appointment-card[_ngcontent-%COMP%]:hover{transform:none}}.appointment-card__header[_ngcontent-%COMP%]{padding:16px;background-color:var(--user-panel-layer-soft);border-bottom:1px solid var(--user-panel-border);display:flex;align-items:center;justify-content:space-between}@media (max-width: 479px){.appointment-card__header[_ngcontent-%COMP%]{padding:12px}}.appointment-card__date[_ngcontent-%COMP%]{align-items:center}.appointment-card__date[_ngcontent-%COMP%]{display:flex;flex-direction:column}.appointment-card__day-name[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:var(--user-panel-primary);text-transform:uppercase}@media (max-width: 479px){.appointment-card__day-name[_ngcontent-%COMP%]{font-size:11px}}.appointment-card__day[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:var(--user-panel-primary);line-height:1}@media (max-width: 479px){.appointment-card__day[_ngcontent-%COMP%]{font-size:20px}}.appointment-card__month[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:var(--user-panel-primary);text-transform:capitalize}@media (max-width: 479px){.appointment-card__month[_ngcontent-%COMP%]{font-size:12px}}.appointment-card__time[_ngcontent-%COMP%]{color:var(--user-panel-primary);font-weight:500}.appointment-card__time[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.appointment-card__time[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:var(--user-panel-primary);width:20px;height:20px}@media (max-width: 479px){.appointment-card__time[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:18px;height:18px}}@media (max-width: 479px){.appointment-card__time[_ngcontent-%COMP%]{font-size:14px}}.appointment-card__body[_ngcontent-%COMP%]{padding:16px}@media (max-width: 479px){.appointment-card__body[_ngcontent-%COMP%]{padding:12px}}.appointment-card__specialty[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:0 0 16px;color:var(--user-panel-text)}@media (max-width: 479px){.appointment-card__specialty[_ngcontent-%COMP%]{font-size:16px;margin-bottom:12px}}.appointment-card__doctor[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]{margin-bottom:12px;color:var(--user-panel-text-muted);font-size:14px}.appointment-card__doctor[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.appointment-card__doctor[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:var(--user-panel-text-soft);width:18px;height:18px}@media (max-width: 479px){.appointment-card__doctor[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:16px;height:16px}}@media (max-width: 479px){.appointment-card__doctor[_ngcontent-%COMP%], .appointment-card__location[_ngcontent-%COMP%]{font-size:13px;margin-bottom:8px}}.appointment-card__status[_ngcontent-%COMP%]{margin-top:12px}@media (max-width: 479px){.appointment-card__status[_ngcontent-%COMP%]{margin-top:8px}}.appointment-card__footer[_ngcontent-%COMP%]{padding:16px;border-top:1px solid var(--user-panel-border)}.appointment-card__footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:12px}@media (max-width: 479px){.appointment-card__footer[_ngcontent-%COMP%]{padding:12px;gap:8px;flex-direction:column;align-items:stretch}}.appointment-card[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{display:inline-block;padding:6px 12px;border-radius:var(--border-radius-sm);font-size:12px;font-weight:500;text-transform:capitalize}.appointment-card[_ngcontent-%COMP%]   .status-badge.status-waiting[_ngcontent-%COMP%]{background-color:color-mix(in srgb,var(--user-panel-warning) 10%,transparent 90%);color:var(--user-panel-warning)}.appointment-card[_ngcontent-%COMP%]   .status-badge.status-completed[_ngcontent-%COMP%]{background-color:color-mix(in srgb,var(--user-panel-success) 10%,transparent 90%);color:var(--user-panel-success)}.appointment-card[_ngcontent-%COMP%]   .status-badge.status-cancelled[_ngcontent-%COMP%]{background-color:color-mix(in srgb,var(--user-panel-danger) 10%,transparent 90%);color:var(--user-panel-danger)}@media (max-width: 479px){.appointment-card[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{font-size:11px;padding:4px 8px}}@media (max-width: 479px){.appointment-card[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%;justify-content:center}}.appointment-card[_ngcontent-%COMP%]   .btn--outline[_ngcontent-%COMP%]{color:var(--user-panel-primary);border-color:var(--user-panel-primary)}.appointment-card[_ngcontent-%COMP%]   .btn--outline[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.appointment-card[_ngcontent-%COMP%]   .btn--outline[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-layer-soft)}.appointment-card[_ngcontent-%COMP%]   .btn--outline[disabled][_ngcontent-%COMP%]{color:var(--user-panel-text-soft);border-color:var(--user-panel-border);cursor:not-allowed}.appointment-card[_ngcontent-%COMP%]   .btn--danger[_ngcontent-%COMP%]{border-color:var(--user-panel-danger)}.appointment-card[_ngcontent-%COMP%]   .btn--danger[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.appointment-card[_ngcontent-%COMP%]   .btn--danger[_ngcontent-%COMP%]:hover{background-color:color-mix(in srgb,var(--user-panel-danger) 10%,transparent 90%)}.appointment-card[_ngcontent-%COMP%]   .btn--danger[disabled][_ngcontent-%COMP%]{color:var(--user-panel-text-soft);border-color:var(--user-panel-border);cursor:not-allowed}.empty-state[_ngcontent-%COMP%]{padding:60px 20px;text-align:center;background-color:var(--user-panel-surface);border-radius:var(--border-radius-md);box-shadow:var(--user-panel-shadow-sm);display:flex;align-items:center;justify-content:center}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]{padding:40px 16px}}.empty-state__icon[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background-color:var(--user-panel-layer-soft);color:var(--user-panel-primary);margin-bottom:24px;display:flex;align-items:center;justify-content:center}.empty-state__icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:40px;height:40px}@media (max-width: 479px){.empty-state__icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:32px;height:32px}}@media (max-width: 479px){.empty-state__icon[_ngcontent-%COMP%]{width:64px;height:64px;margin-bottom:16px}}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0 0 8px;color:var(--user-panel-text)}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px}}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:var(--user-panel-text-muted);margin:0 0 24px}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;margin-bottom:16px}}.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--user-panel-primary) 0%,var(--user-panel-primary-dark) 100%)}.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]:hover{background-color:var(--user-panel-primary-dark)}@media (max-width: 479px){.empty-state[_ngcontent-%COMP%]   .btn--primary[_ngcontent-%COMP%]{width:100%}}.loading-spinner[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--user-panel-text)}.loading-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column}.loading-spinner[_ngcontent-%COMP%]   .loading-icon[_ngcontent-%COMP%]{font-size:2rem;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:.5rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{be as AppointmentsComponent};
