import{a as l}from"./chunk-4W6XZAEZ.js";import{a as d,d as g}from"./chunk-3F3ZFDNX.js";import{$ as u,C as o,W as p,m as c,q as a}from"./chunk-U346BHW4.js";var s={GET_APPOINTMENTS:"medic/appointments",GET_TURNS:"medic/turns/",GET_BY_ID:n=>`/medic/turns/user/${n}`,GET_TURN:n=>`medic/turns/${n}`,CREATE_TURN:"medic/turns/add/",UPDATE_TURN_STATE:(n,e)=>`/medic/turns/update/state${n&&e?`?turn_id=${n}&new_state=${e}`:""}`,DELETE_TURN:n=>`medic/turns/delete/${n}`,RESCHEDULE_TURN:n=>`medic/turns/${n}/reschedule`};var T=class n{constructor(e,r,t){this.apiService=e;this.logger=r;this.storage=t}getAppointments(e){let r=`${s.GET_APPOINTMENTS}?user_id=${e}`;return this.apiService.get(r).pipe(a(t=>t||[]),o(t=>this.handleError("Error fetching appointments",t)))}getTurns(){return this.logger.debug("Obteniendo lista de turnos"),this.apiService.get(s.GET_TURNS).pipe(a(e=>e||[]),o(e=>this.handleError("Error fetching turns",e)))}getTurnsByUserId(e){return this.logger.debug(`Obteniendo turnos para el usuario: ${e}`),this.apiService.get(s.GET_BY_ID(e)).pipe(a(r=>r||[]),o(r=>this.handleError(`Error fetching turns for user ${e}`,r)))}getTurnById(e){return this.logger.debug(`Obteniendo turno con ID: ${e}`),this.apiService.get(s.GET_TURN(e)).pipe(o(r=>this.handleError(`Error fetching turn ${e}`,r)))}createTurn(e){return this.logger.debug("Creando nuevo turno",e),this.apiService.post(s.CREATE_TURN,e).pipe(o(r=>this.handleError("Error creating turn",r)))}updateTurnState(e,r){let t=`${s.UPDATE_TURN_STATE()}?turn_id=${encodeURIComponent(e)}&new_state=${encodeURIComponent(r)}`;return this.logger.debug(`Updating turn state for turn ${e} with newState: ${r} at ${t}`),this.apiService.patch(t,null).pipe(o(i=>this.handleError(`Error updating turn state for turn ${e}`,i)))}rescheduleTurn(e,r){return this.logger.debug(`Rescheduling turn ${e}`,r),this.apiService.patch(s.RESCHEDULE_TURN(e),r).pipe(o(t=>this.handleError(`Error rescheduling turn ${e}`,t)))}deleteTurn(e){return this.logger.debug(`Eliminando turno con ID: ${e}`),this.apiService.delete(s.DELETE_TURN(e)).pipe(o(r=>this.handleError(`Error deleting turn ${e}`,r)))}handleError(e,r){this.logger.error(e,r);let t="An unexpected error occurred";if(r instanceof Error)t=r.message;else if(typeof r=="object"&&r!==null&&"status"in r){let i=r;switch(i.status){case 400:t=i.error?.detail??"Invalid request data";break;case 401:t=i.error?.detail??"Unauthorized access",this.storage.clearStorage();break;case 403:t=i.error?.detail??"Forbidden action";break;case 404:t=i.error?.detail??"Resource not found";break;case 405:t=i.error?.detail??"Method not allowed";break;default:t=i.error?.detail??"Server error"}}return c(()=>new Error(t))}static \u0275fac=function(r){return new(r||n)(u(g),u(d),u(l))};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};export{T as a};
