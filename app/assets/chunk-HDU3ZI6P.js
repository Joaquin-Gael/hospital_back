import{a as F}from"./chunk-65MXE2XU.js";import{a as $}from"./chunk-RBRDWJHI.js";import"./chunk-QMYIRM4F.js";import{a as j}from"./chunk-2WAWTWTY.js";import{a as H}from"./chunk-Y6I3CS6I.js";import{a as L}from"./chunk-BR3QFQIC.js";import"./chunk-GK5PG2NL.js";import"./chunk-R25INWIT.js";import"./chunk-HDR7MDZE.js";import"./chunk-O57RU464.js";import{a as z}from"./chunk-YOZKJIIB.js";import{d as I}from"./chunk-RTO3QJN4.js";import"./chunk-NSPTTQBB.js";import"./chunk-ZGRDZCQA.js";import{$b as E,Cb as u,Db as S,Fb as k,Gb as D,Hb as i,Ib as o,Jb as c,Mb as v,Nc as T,Ob as h,Pb as l,S as C,Uc as A,Zb as a,_a as r,_b as p,aa as d,f as y,ia as m,ic as V,ja as _,ka as x,kb as P,la as M,pb as O,sa as w,wb as f}from"./chunk-MFDETKI4.js";import"./chunk-4CLCTAJ7.js";var R=(n,e)=>({"status-badge--completed":n,"status-badge--cancelled":e});function B(n,e){n&1&&c(0,"app-loading-spinner",0),n&2&&f("message","Cargando historial...")}function U(n,e){if(n&1&&(i(0,"div",2)(1,"p"),a(2),o()()),n&2){let t=l(2);r(2),p(t.error)}}function G(n,e){if(n&1){let t=v();i(0,"tr")(1,"td")(2,"div",5)(3,"div",6),a(4),o(),i(5,"div",7),a(6),o()()(),i(7,"td"),a(8),o(),i(9,"td"),a(10),o(),i(11,"td")(12,"span",8),c(13,"span",9),a(14),o()(),i(15,"td",10)(16,"button",11),h("click",function(){let g=m(t).$implicit,b=l(3);return _(b.onViewDetails(g))}),x(),i(17,"svg",12),c(18,"path",13)(19,"path",14),o()(),M(),i(20,"button",15),h("click",function(){let g=m(t).$implicit,b=l(3);return _(b.onDownloadReceipt(g))}),x(),i(21,"svg",12),c(22,"path",16),o()()()()}if(n&2){let t=e.$implicit,s=l(3);r(4),p(s.formatShortDate(t.date)),r(2),p(t.time),r(2),p(t.specialty),r(2),p(t.doctorName),r(2),f("ngClass",V(6,R,t.state==="finished",t.state==="cancelled")),r(2),E(" ",s.getStateText(t.state)," ")}}function q(n,e){n&1&&(i(0,"tr")(1,"td",17)(2,"div",18)(3,"div",19),x(),i(4,"svg",12),c(5,"path",20),o()(),M(),i(6,"h2"),a(7,"No hay historial"),o(),i(8,"p"),a(9,"Tus citas anteriores aparecer\xE1n aqu\xED."),o()()()())}function J(n,e){if(n&1&&(i(0,"div",3)(1,"table",4)(2,"thead")(3,"tr")(4,"th"),a(5,"Fecha"),o(),i(6,"th"),a(7,"Especialidad"),o(),i(8,"th"),a(9,"M\xE9dico"),o(),i(10,"th"),a(11,"Estado"),o(),i(12,"th"),a(13,"Acciones"),o()()(),i(14,"tbody"),k(15,G,23,9,"tr",null,S,!1,q,10,0,"tr"),o()()()),n&2){let t=l(2);r(15),D(t.filteredAppointments)}}function K(n,e){if(n&1&&O(0,U,3,1,"div",2)(1,J,18,1,"div",3),n&2){let t=l();u(t.error?0:1)}}function Q(n,e){if(n&1){let t=v();i(0,"app-view-dialog",21),h("close",function(){m(t);let g=l();return _(g.closeViewDialog())}),o()}if(n&2){let t=l();f("isOpen",t.viewDialogOpen)("title",t.viewDialogTitle)("item",t.viewDialogItem)("columns",t.viewDialogColumns)}}var N=class n{appointments=[];loading=!1;viewDetails=new w;downloadReceipt=new w;authService=d(H);notificationService=d(L);appointmentService=d($);logger=d(z);router=d(I);localAppointments=[];localLoading=!0;error=null;destroy$=new y;viewDialogOpen=!1;viewDialogItem={};viewDialogTitle="";viewDialogColumns=[{key:"reason",label:"Motivo"},{key:"date",label:"Fecha",format:e=>this.formatShortDate(e)},{key:"time",label:"Hora"},{key:"specialty",label:"Especialidad"},{key:"doctorName",label:"M\xE9dico"},{key:"state",label:"Estado",format:e=>this.getStateText(e)}];ngOnInit(){if(this.appointments.length>0){this.localAppointments=this.appointments.filter(e=>e.state!=="waiting"),this.localLoading=this.loading;return}if(!this.authService.isLoggedIn()){this.logger.info("Usuario no autenticado, redirigiendo a /login"),this.router.navigate(["/login"]);return}this.authService.getUser().pipe(C(this.destroy$)).subscribe({next:e=>{if(!e){this.error="No se encontraron datos del usuario",this.logger.error("No user data found"),this.router.navigate(["/login"]),this.localLoading=!1;return}this.loadAppointments(e.id)},error:e=>{this.error="Error al cargar los datos del usuario",this.localLoading=!1,this.logger.error("Failed to load user",e),this.router.navigate(["/login"])}})}loadAppointments(e){this.localLoading=!0,this.appointmentService.getTurnsByUserId(e).pipe(C(this.destroy$)).subscribe({next:t=>{this.localAppointments=this.mapTurnsToAppointments(t),this.localLoading=!1,this.logger.debug("History appointments loaded successfully",this.localAppointments)},error:t=>{this.error="Error al cargar el historial de turnos",this.localLoading=!1,this.logger.error("Error loading history appointments",t)}})}mapTurnsToAppointments(e){return e.filter(t=>t.state!=="waiting").map(t=>({id:t.appointment_id??t.id,reason:t.reason,turnId:t.id,date:t.date,time:t.time.split(":").slice(0,2).join(":"),specialty:t.service?.[0]?.name??"Sin especialidad",doctorName:t.doctor?`${t.doctor.first_name} ${t.doctor.last_name}`.trim():"Sin m\xE9dico asignado",state:t.state}))}get filteredAppointments(){return this.appointments.length>0?this.appointments.filter(e=>e.state!=="waiting"):this.localAppointments}formatShortDate(e){return new Date(e).toLocaleDateString("es-AR",{day:"2-digit",month:"2-digit",year:"2-digit"})}formatFullDate(e){return new Date(e).toLocaleDateString("es-AR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}getStateText(e){switch(e){case"finished":return"Completada";case"cancelled":return"Cancelada";case"confirmed":return"Confirmada";case"pending":return"Pendiente";default:return"Estado desconocido"}}onViewDetails(e){this.viewDialogItem=e,this.viewDialogTitle=`Detalles de la Cita - ${e.specialty}`,this.viewDialogOpen=!0,this.logger.debug("Opening view dialog for appointment",e),this.viewDetails.emit(e)}closeViewDialog(){this.viewDialogOpen=!1,this.viewDialogItem={}}onDownloadReceipt(e){this.notificationService.info("Descarga de comprobante pr\xF3ximamente disponible"),this.downloadReceipt.emit(e)}trackById(e,t){return t.id}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-history"]],inputs:{appointments:"appointments",loading:"loading"},outputs:{viewDetails:"viewDetails",downloadReceipt:"downloadReceipt"},decls:4,vars:2,consts:[[3,"message"],[3,"isOpen","title","item","columns"],[1,"error-state"],[1,"table-container"],[1,"table"],[1,"table__date"],[1,"table__date-day"],[1,"table__date-time"],[1,"status-badge",3,"ngClass"],[1,"status-badge__dot"],[1,"table__actions"],["title","Ver detalles",1,"btn-icon",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"icon"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["title","Descargar comprobante",1,"btn-icon",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"],["colspan","5"],[1,"empty-state"],[1,"empty-state__icon"],["stroke-linecap","round","stroke-linejoin","round","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[3,"close","isOpen","title","item","columns"]],template:function(t,s){t&1&&(i(0,"section"),O(1,B,1,1,"app-loading-spinner",0)(2,K,2,1)(3,Q,1,4,"app-view-dialog",1),o()),t&2&&(r(),u(s.localLoading?1:2),r(2),u(s.viewDialogOpen?3:-1))},dependencies:[A,T,j,F],styles:[".icon[_ngcontent-%COMP%]{width:20px;height:20px;stroke-width:2}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;transition:all .2s ease;border:none;color:#fff}.btn--primary[_ngcontent-%COMP%]{color:#fff;background:linear-gradient(135deg,#3b82f6,#1d4ed8)}.btn--outline[_ngcontent-%COMP%]{background-color:transparent;color:#1f2937;border:1px solid #e5e7eb}.btn--outline[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.btn--danger[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff}.btn--danger[_ngcontent-%COMP%]:hover{background-color:#ed2d2d}.btn--sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.btn[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:16px;height:16px}.btn-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background-color:transparent;color:#6b7280;border:none;cursor:pointer;transition:all .2s ease}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}.btn-icon[_ngcontent-%COMP%]:hover{background-color:#f9fafb;color:#3b82f6}.btn-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:18px;height:18px}.empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;padding:60px 20px;text-align:center}.empty-state__icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:80px;height:80px;border-radius:50%;background-color:#3b82f61a;color:#3b82f6;margin-bottom:24px}.empty-state__icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:40px;height:40px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0 0 8px;color:#1f2937}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;margin:0 0 24px}.table-container[_ngcontent-%COMP%]{margin-top:32px;overflow-x:auto;border-radius:8px;box-shadow:0 1px 3px #0000001a}@media (max-width: 479px){.table-container[_ngcontent-%COMP%]{margin:0 -16px;border-radius:0}}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;min-width:600px}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:16px;text-align:left}@media (max-width: 479px){.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px}}@media (min-width: 480px) and (max-width: 767px){.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:14px 12px}}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f9fafb;color:#6b7280;font-weight:500;font-size:14px;border-bottom:1px solid #e5e7eb;position:sticky;top:0;z-index:1}@media (max-width: 479px){.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:12px}}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #e5e7eb;color:#1f2937;font-size:14px}@media (max-width: 479px){.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:13px}}.table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background-color:#f9fafb}@media (hover: none) and (pointer: coarse){.table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background-color:transparent}}.table__date[_ngcontent-%COMP%]{display:flex;flex-direction:column}.table__date-day[_ngcontent-%COMP%]{font-weight:500;color:#1f2937}@media (max-width: 479px){.table__date-day[_ngcontent-%COMP%]{font-size:13px}}.table__date-time[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;margin-top:4px}@media (max-width: 479px){.table__date-time[_ngcontent-%COMP%]{font-size:11px}}.table__actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:8px}@media (max-width: 479px){.table__actions[_ngcontent-%COMP%]{flex-direction:column;gap:4px}}.status-badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:9999px;font-size:12px;font-weight:500;background-color:#6b72801a;color:#6b7280;white-space:nowrap}.status-badge[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px}.status-badge__dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;background-color:#6b7280;flex-shrink:0}.status-badge--completed[_ngcontent-%COMP%]{background-color:#10b9811a;color:#10b981}.status-badge--completed[_ngcontent-%COMP%]   .status-badge__dot[_ngcontent-%COMP%]{background-color:#10b981}.status-badge--cancelled[_ngcontent-%COMP%]{background-color:#ef44441a;color:#ef4444}.status-badge--cancelled[_ngcontent-%COMP%]   .status-badge__dot[_ngcontent-%COMP%]{background-color:#ef4444}@media (max-width: 479px){.status-badge[_ngcontent-%COMP%]{font-size:11px;padding:3px 8px}.status-badge__dot[_ngcontent-%COMP%]{width:6px;height:6px}}.loading-spinner[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#1f2937}.loading-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column}.loading-spinner[_ngcontent-%COMP%]   .loading-icon[_ngcontent-%COMP%]{font-size:2rem;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:.5rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{N as HistoryComponent};
