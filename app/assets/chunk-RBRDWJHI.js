import{a as T}from"./chunk-R25INWIT.js";import{a as d,b as g}from"./chunk-YOZKJIIB.js";import{$ as p,B as o,W as c,m as u,p as s}from"./chunk-MFDETKI4.js";var a={GET_APPOINTMENTS:"medic/appointments",GET_TURNS:"medic/turns/",GET_BY_ID:i=>`medic/turns/${i}`,GET_TURN:i=>`medic/turns/${i}`,CREATE_TURN:"medic/turns/add/",UPDATE_TURN_STATE:(i,e)=>`/medic/turns/update/state${i&&e?`?turn_id=${i}&new_state=${e}`:""}`,DELETE_TURN:i=>`medic/turns/delete/${i}`};var l=class i{constructor(e,r,t){this.apiService=e;this.logger=r;this.storage=t}getAppointments(e){let r=`${a.GET_APPOINTMENTS}?user_id=${e}`;return this.apiService.get(r).pipe(s(t=>t||[]),o(t=>this.handleError("Error fetching appointments",t)))}getTurns(){return this.logger.debug("Obteniendo lista de turnos"),this.apiService.get(a.GET_TURNS).pipe(s(e=>e||[]),o(e=>this.handleError("Error fetching turns",e)))}getTurnsByUserId(e){return this.logger.debug(`Obteniendo turnos para el usuario: ${e}`),this.apiService.get(a.GET_BY_ID(e)).pipe(s(r=>r||[]),o(r=>this.handleError(`Error fetching turns for user ${e}`,r)))}getTurnById(e){return this.logger.debug(`Obteniendo turno con ID: ${e}`),this.apiService.get(a.GET_TURN(e)).pipe(o(r=>this.handleError(`Error fetching turn ${e}`,r)))}createTurn(e){return this.logger.debug("Creando nuevo turno",e),this.apiService.post(a.CREATE_TURN,e).pipe(o(r=>this.handleError("Error creating turn",r)))}updateTurnState(e,r){let t=`${a.UPDATE_TURN_STATE()}?turn_id=${encodeURIComponent(e)}&new_state=${encodeURIComponent(r)}`;return this.logger.debug(`Updating turn state for turn ${e} with newState: ${r} at ${t}`),this.apiService.patch(t,null).pipe(o(n=>this.handleError(`Error updating turn state for turn ${e}`,n)))}deleteTurn(e){return this.logger.debug(`Eliminando turno con ID: ${e}`),this.apiService.delete(a.DELETE_TURN(e)).pipe(o(r=>this.handleError(`Error deleting turn ${e}`,r)))}handleError(e,r){this.logger.error(e,r);let t="An unexpected error occurred";if(r instanceof Error)t=r.message;else if(typeof r=="object"&&r!==null&&"status"in r){let n=r;switch(n.status){case 400:t=n.error?.detail??"Invalid request data";break;case 401:t=n.error?.detail??"Unauthorized access",this.storage.clearStorage();break;case 403:t=n.error?.detail??"Forbidden action";break;case 404:t=n.error?.detail??"Resource not found";break;case 405:t=n.error?.detail??"Method not allowed";break;default:t=n.error?.detail??"Server error"}}return u(()=>new Error(t))}static \u0275fac=function(r){return new(r||i)(p(g),p(d),p(T))};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};export{l as a};
