import{b as d,c as R}from"./chunk-GGYCCLGV.js";import{B as i,O as E,R as p,T as v,W as u,Z as h,aa as l,k as b,l as s,o as f,p as g,u as m,vc as L}from"./chunk-VYPP3LKO.js";var U={error:1,warn:2,info:3,debug:4},c=class a{APP_PREFIX="[HOSPITALSDLGAPP]";minLogLevel;constructor(){this.minLogLevel=L()?"debug":"error"}error(r,e){this.log("error",r,e)}warn(r,e){this.log("warn",r,e)}info(r,e){this.log("info",r,e)}debug(r,e){this.log("debug",r,e)}log(r,e,t){if(this.shouldLog(r)){let o=this.formatMessage(r,e);this.outputLog(r,o,t)}}shouldLog(r){return U[r]<=U[this.minLogLevel]}formatMessage(r,e){let t=new Date().toISOString();return`${this.APP_PREFIX} [${r.toUpperCase()}] ${t} - ${e}`}outputLog(r,e,t){switch(r){case"error":console.error(e,t);break;case"warn":console.warn(e,t);break;case"info":console.info(e,t);break;case"debug":console.debug(e,t);break}}static \u0275fac=function(e){return new(e||a)};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};var $=new h("API_BASE_URL"),H=new h("API_WS_BASE_URL");var P=class a{http=l(R);baseUrl=l($);baseWsUrl=l(H);logger=l(c);uuid$=this.createUuidStream();getUuid(){return f(this.uuid$)}createUuidStream(){return m(()=>this.http.get(`${this.baseUrl}/id_prefix_api_secret/`)).pipe(v(r=>{this.logger.debug("UUID fetched",r.id_prefix_api_secret)}),g(r=>r.id_prefix_api_secret),i(r=>{let e=this.toHttpErrorResponse(r,"No se pudo cargar el UUID de la API");return this.logger.error("Error fetching UUID",e),s(()=>e)}),E({bufferSize:1,refCount:!1}))}buildUrl(r){return/^https?:\/\//i.test(r)?b(r):this.uuid$.pipe(g(e=>{let t=r.replace(/^\/+|\/+$/g,"");return`${this.baseUrl}/${e}/${t}`}),i(e=>{let t=this.toHttpErrorResponse(e,`Error al construir la URL para ${r}`);return this.logger.error("Error building URL",t),s(()=>t)}))}buildWsUrl(r){return this.uuid$.pipe(g(e=>{let t=r.replace(/^\/+|\/+$/g,"");return`${this.baseWsUrl}/${e}/${t}`}),i(e=>{let t=this.toHttpErrorResponse(e,`Error al construir la URL de WebSocket para ${r}`);return this.logger.error("Error building WebSocket URL",t),s(()=>t)}))}get(r,e){return this.buildUrl(r).pipe(p(t=>this.http.get(t,e)),i(t=>{let o=this.toHttpErrorResponse(t,`Error al obtener datos de ${r}`);return this.logger.error(`Error in GET ${r}`,o),s(()=>o)}))}post(r,e,t){return this.buildUrl(r).pipe(p(o=>this.http.post(o,e,t)),i(o=>{let n=this.toHttpErrorResponse(o,`Error al enviar datos a ${r}`);return this.logger.error(`Error in POST ${r}`,n),s(()=>n)}))}put(r,e,t){return this.buildUrl(r).pipe(p(o=>this.http.put(o,e,t)),i(o=>{let n=this.toHttpErrorResponse(o,`Error al actualizar datos en ${r}`);return this.logger.error(`Error in PUT ${r}`,n),s(()=>n)}))}delete(r,e){return this.buildUrl(r).pipe(p(t=>this.http.delete(t,e)),i(t=>{let o=this.toHttpErrorResponse(t,`Error al eliminar datos en ${r}`);return this.logger.error(`Error in DELETE ${r}`,o),s(()=>o)}))}patch(r,e,t){return this.buildUrl(r).pipe(p(o=>this.http.patch(o,e,t)),i(o=>{let n=this.toHttpErrorResponse(o,`Error al modificar datos en ${r}`);return this.logger.error(`Error in PATCH ${r}`,n),s(()=>n)}))}toHttpErrorResponse(r,e){return r instanceof d?r:new d({error:r,status:typeof r=="object"&&r!==null&&"status"in r?r.status:0,statusText:e})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};export{c as a,$ as b,H as c,P as d};
